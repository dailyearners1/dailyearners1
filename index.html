v<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DailyEarners Investment Platform</title>
    <link href="https://fonts.googleapis.com/css2?family=Baskerville:wght@400;700&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script type="text/javascript" src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <meta name="google-signin-client_id" content="147819078141-4t9v0v0v0v0v0v0v0v0v0v0v0v0v0v.apps.googleusercontent.com">
    <meta name="google-signin-scope" content="profile email">
    
    <style>
        /* General Body and Container Styles */
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(to right, #e0f2f7, #bbdefb);
            color: #333;
            line-height: 1.6;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            transition: background-image 1s ease-in-out;
            position: relative;
            min-height: 100vh;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.6);
            z-index: -1;
            pointer-events: none;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background-color: rgba(255, 255, 255, 0.8);
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        section {
            display: none;
            padding: 20px;
            flex-grow: 1;
        }

        .active-page {
            display: flex;
            flex-direction: column;
        }

        h1, h2, h3 {
            font-family: 'Baskerville', serif;
            color: #004080;
            text-align: center;
            margin-bottom: 20px;
        }

        h1 { font-size: 3em; }
        h2 { font-size: 2.5em; }
        h3 { font-size: 1.8em; }

        p {
            font-family: 'Times New Roman', serif;
        }

        /* Buttons */
        .btn {
            display: inline-block;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            transition: all 0.3s ease;
            text-decoration: none;
            text-align: center;
        }

        .btn-primary {
            background: linear-gradient(45deg, #007bff, #0056b3);
            color: white;
            box-shadow: 0 4px 10px rgba(0, 123, 255, 0.4);
        }

        .btn-primary:hover {
            background: linear-gradient(45deg, #0056b3, #007bff);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 123, 255, 0.6);
        }

        .btn-login, .btn-register {
            background-color: #f7b731;
            color: #333;
            margin-left: 10px;
            box-shadow: 0 4px 10px rgba(247, 183, 49, 0.4);
        }

        .btn-login:hover, .btn-register:hover {
            background-color: #e0a21d;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(247, 183, 49, 0.6);
        }

        .btn-apply {
            background: linear-gradient(45deg, #28a745, #218838);
            color: white;
            box-shadow: 0 4px 10px rgba(40, 167, 69, 0.4);
        }

        .btn-apply:hover {
            background: linear-gradient(45deg, #218838, #28a745);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(40, 167, 69, 0.6);
        }

        .btn-success {
            background: linear-gradient(45deg, #5cb85c, #4cae4c);
            color: white;
            box-shadow: 0 4px 10px rgba(92, 184, 92, 0.4);
        }

        .btn-success:hover {
            background: linear-gradient(45deg, #4cae4c, #5cb85c);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(92, 184, 92, 0.6);
        }

        .btn-danger {
            background: linear-gradient(45deg, #dc3545, #c82333);
            color: white;
            box-shadow: 0 4px 10px rgba(220, 53, 69, 0.4);
        }

        .btn-danger:hover {
            background: linear-gradient(45deg, #c82333, #dc3545);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(220, 53, 69, 0.6);
        }

        .btn-info {
            background: linear-gradient(45deg, #17a2b8, #138496);
            color: white;
            box-shadow: 0 4px 10px rgba(23, 162, 184, 0.4);
        }

        .btn-info:hover {
            background: linear-gradient(45deg, #138496, #17a2b8);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(23, 162, 184, 0.6);
        }

        .btn-logout {
            background-color: #6c757d;
            color: white;
            margin-left: 20px;
        }

        .btn-logout:hover {
            background-color: #5a6268;
        }

        .btn-google {
            background: linear-gradient(45deg, #4285f4, #34a853, #fbbc05, #ea4335);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            margin: 10px 5px;
            box-shadow: 0 4px 10px rgba(66, 133, 244, 0.3);
        }

        .btn-google:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(66, 133, 244, 0.4);
        }

        .btn-google i {
            font-size: 1.2em;
        }


        .auth-divider {
            text-align: center;
            margin: 20px 0;
            position: relative;
            color: #666;
            font-size: 0.9em;
        }

        .auth-divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: #ddd;
            z-index: 1;
        }

        .auth-divider span {
            background: white;
            padding: 0 15px;
            position: relative;
            z-index: 2;
        }


        .btn-copy {
            background-color: #6f42c1;
            color: white;
        }

        .btn-copy:hover {
            background-color: #5b2fa0;
        }

        .back-btn {
            background: none;
            border: none;
            color: #007bff;
            font-size: 1.1em;
            cursor: pointer;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }

        .back-btn i {
            margin-right: 8px;
        }

        .back-btn:hover {
            text-decoration: underline;
        }

        .main-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 30px;
            background: linear-gradient(to right, #007bff, #0056b3);
            color: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .main-header .logo {
            display: flex;
            align-items: center;
        }

        .main-header .logo img {
            border-radius: 50%;
            margin-right: 10px;
            border: 2px solid white;
        }

        .main-header .logo h1 {
            color: white;
            margin: 0;
            font-size: 1.8em;
        }

        .main-header nav ul {
            list-style: none;
            margin: 0;
            padding: 0;
            display: flex;
        }

        .main-header nav ul li {
            margin-right: 25px;
        }

        .main-header nav ul li a {
            color: white;
            text-decoration: none;
            font-weight: bold;
            font-size: 1.1em;
            position: relative;
            transition: color 0.3s ease;
        }

        .main-header nav ul li a::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            background-color: #f7b731;
            left: 0;
            bottom: -5px;
            transition: width 0.3s ease-in-out;
        }

        .main-header nav ul li a:hover::after {
            width: 100%;
        }

        .main-header nav ul li a:hover {
            color: #f7b731;
        }

        .hero-section {
            display: flex;
            align-items: center;
            justify-content: space-around;
            padding: 60px 40px;
            background: linear-gradient(to right, #f0f8ff, #e6f7ff);
            text-align: center;
            gap: 30px;
        }

        .hero-content {
            max-width: 600px;
            text-align: left;
        }

        .hero-content .motto {
            font-size: 3.5em;
            color: #004080;
            margin-bottom: 20px;
            text-shadow: 2px 2px 5px rgba(0,0,0,0.1);
        }

        .hero-content .mission {
            font-size: 1.2em;
            color: #555;
            margin-bottom: 30px;
        }

        .hero-graphics img {
            max-width: 100%;
            height: auto;
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            animation: fadeInScale 1s ease-out forwards;
        }

        @keyframes fadeInScale {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        .info-section {
            background-color: #f9f9f9;
            padding: 60px 40px;
            text-align: center;
        }

        .info-section h2 {
            margin-bottom: 40px;
        }

        .work-process {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
        }

        .work-process .step {
            background-color: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
            width: 30%;
            min-width: 280px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .work-process .step:hover {
            transform: translateY(-10px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .work-process .step .icon-large {
            font-size: 3.5em;
            color: #007bff;
            margin-bottom: 15px;
            animation: bounceIn 0.8s ease-out;
        }

        @keyframes bounceIn {
            0% { transform: scale(0.1); opacity: 0; }
            60% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); }
        }

        .auth-page {
            background: linear-gradient(to right, #e0f7fa, #b2ebf2);
            padding: 50px 0;
            justify-content: center;
            align-items: center;
        }

        .auth-page h2 {
            color: #00796b;
            margin-bottom: 30px;
        }

        .auth-page form {
            background-color: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            max-width: 450px;
            width: 100%;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }

        .form-group input[type="text"],
        .form-group input[type="email"],
        .form-group input[type="tel"],
        .form-group input[type="password"],
        .form-group input[type="number"],
        .form-group select {
            width: calc(100% - 20px);
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            border-color: #007bff;
            box-shadow: 0 0 8px rgba(0, 123, 255, 0.2);
            outline: none;
        }

        .password-toggle {
            position: absolute;
            right: 10px;
            top: 60%;
            transform: translateY(-50%);
            cursor: pointer;
            color: #888;
        }

        .auth-link, .forgot-password {
            margin-top: 20px;
            font-size: 0.95em;
        }

        .auth-link a, .forgot-password a {
            color: #007bff;
            text-decoration: none;
            font-weight: bold;
        }

        .auth-link a:hover, .forgot-password a:hover {
            text-decoration: underline;
        }

        .error-message {
            color: #dc3545;
            font-size: 0.9em;
            margin-top: 5px;
            text-align: left;
        }

        .dashboard-section {
            display: none;
            flex-direction: column;
            height: 100%;
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 30px;
            background: linear-gradient(to right, #1a237e, #3f51b5);
            color: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            flex-shrink: 0;
        }

        .dashboard-header .header-left, .dashboard-header .header-right {
            display: flex;
            align-items: center;
        }

        .dashboard-header .logo {
            display: flex;
            align-items: center;
            margin-right: 30px;
        }

        .dashboard-header .logo img {
            border-radius: 50%;
            margin-right: 10px;
            border: 2px solid white;
        }

        .dashboard-header .logo h3 {
            color: white;
            margin: 0;
            font-size: 1.5em;
        }

        .dashboard-header .user-info {
            font-size: 1.1em;
        }

        .dashboard-header .user-info #welcome-message {
            font-weight: bold;
            margin-right: 15px;
        }

        .dashboard-header .user-info #account-balance {
            background-color: #f7b731;
            color: #333;
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: bold;
            animation: pulsate 1.5s infinite alternate;
        }

        @keyframes pulsate {
            from { transform: scale(1); box-shadow: 0 0 5px rgba(247, 183, 49, 0.5); }
            to { transform: scale(1.05); box-shadow: 0 0 15px rgba(247, 183, 49, 0.8); }
        }

        .welcome-bonus-badge {
            background: linear-gradient(45deg, #ff6b6b, #ee4040);
            color: white;
            padding: 8px 15px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 0.95em;
            animation: bounceFadeIn 1s ease-out;
            margin-right: 15px;
            box-shadow: 0 4px 10px rgba(255, 107, 107, 0.5);
        }

        @keyframes bounceFadeIn {
            0% { transform: scale(0.1); opacity: 0; }
            60% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); }
        }

        .dashboard-content {
            display: flex;
            flex-grow: 1;
        }

        .sidebar {
            width: 250px;
            background: linear-gradient(to bottom, #2c3e50, #4a6a8c);
            padding: 20px;
            box-shadow: 4px 0 10px rgba(0, 0, 0, 0.1);
            flex-shrink: 0;
        }

        .dashboard-nav ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .dashboard-nav ul li {
            margin-bottom: 10px;
        }

        .dashboard-nav ul li a {
            display: block;
            padding: 12px 15px;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            transition: background-color 0.3s ease, transform 0.2s ease;
            display: flex;
            align-items: center;
            font-size: 1.05em;
        }

        .dashboard-nav ul li a i {
            margin-right: 10px;
            font-size: 1.2em;
        }

        .dashboard-nav ul li a:hover {
            background-color: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }

        .dashboard-nav ul li a.active {
            background: linear-gradient(to right, #f7b731, #f29c00);
            color: #333;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(247, 183, 49, 0.4);
        }

        .dashboard-nav ul li a.active:hover {
            background: linear-gradient(to right, #f29c00, #f7b731);
        }

        .main-dashboard-area {
            flex-grow: 1;
            padding: 30px;
            background-color: #f0f2f5;
            overflow-y: auto;
        }

        .dashboard-tab-content {
            display: none;
        }

        .dashboard-tab-content.active {
            display: block;
        }

        .package-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }

        .package-card {
            background-color: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
            text-align: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 2px solid transparent;
        }

        .package-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
            border-color: #007bff;
        }

        .package-card h3 {
            color: #004080;
            margin-top: 0;
            font-size: 1.7em;
        }

        .package-card .range {
            font-size: 1.1em;
            color: #666;
            margin-bottom: 10px;
        }

        .package-card .earning {
            font-size: 1.4em;
            font-weight: bold;
            color: #28a745;
            margin-bottom: 15px;
        }

        .package-card .earning span {
            background-color: #d4edda;
            padding: 5px 10px;
            border-radius: 5px;
        }

        .package-card .duration {
            font-size: 1em;
            color: #888;
            margin-bottom: 20px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background-color: white;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            border-radius: 8px;
            overflow: hidden;
        }

        .data-table th, .data-table td {
            border: 1px solid #e0e0e0;
            padding: 12px 15px;
            text-align: left;
        }

        .data-table th {
            background-color: #007bff;
            color: white;
            font-weight: bold;
            text-transform: uppercase;
            font-size: 0.9em;
        }

        .data-table tr:nth-child(even) {
            background-color: #f8f8f8;
        }

        .data-table tr:hover {
            background-color: #f1f1f1;
        }

        .deposit-options, .deposit-form, #withdrawal-form {
            background-color: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.08);
            margin-bottom: 30px;
        }

        .deposit-options {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
        }

        .deposit-method {
            flex: 1 1 300px;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            background-color: #fdfdfd;
            transition: box-shadow 0.3s ease;
        }

        .deposit-method:hover {
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }

        .deposit-method .payment-logo {
            width: 100px;
            height: 100px;
            margin-bottom: 15px;
            border-radius: 15px;
            object-fit: contain;
            background-color: #ffffff;
            padding: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
            border: 2px solid #e9ecef;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            animation: logoFadeIn 0.6s ease-out forwards;
            position: relative;
        }

        @keyframes logoFadeIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .deposit-method .payment-logo:hover {
            transform: scale(1.08);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25);
            border-color: #007bff;
        }

        .deposit-method h3 {
            margin-top: 0;
            color: #004080;
        }

        .deposit-method p {
            font-size: 0.9em;
            color: #666;
        }

        .min-max-info {
            font-weight: bold;
            color: #007bff;
            text-align: center;
            margin-bottom: 20px;
        }

        .referral-info {
            background-color: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
            text-align: center;
        }

        .referral-info p {
            font-size: 1.1em;
            margin-bottom: 10px;
        }

        .referral-info strong {
            color: #28a745;
        }

        .referral-info a {
            color: #007bff;
            text-decoration: none;
        }

        .referral-info a:hover {
            text-decoration: underline;
        }

        .contact-methods {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }

        .contact-card {
            background-color: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
            text-align: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .contact-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        }

        .contact-card .icon-large {
            font-size: 4em;
            margin-bottom: 15px;
        }

        .whatsapp-color { color: #25D366; }
        .telegram-color { color: #0088cc; }
        .email-color { color: #D44638; }
        .location-color { color: #f44336; }

        .contact-card h3 {
            margin-top: 0;
            color: #004080;
        }

        .contact-card p {
            font-size: 0.95em;
            color: #666;
        }

        .contact-card .btn {
            margin-top: 15px;
            width: 80%;
        }

        .btn-whatsapp { background-color: #25D366; color: white; }
        .btn-whatsapp:hover { background-color: #1DA851; }
        .btn-telegram { background-color: #0088cc; color: white; }
        .btn-telegram:hover { background-color: #006da7; }
        .btn-email { background-color: #D44638; color: white; }
        .btn-email:hover { background-color: #B03429; }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 30px;
            border: 1px solid #888;
            width: 90%;
            max-width: 500px;
            border-radius: 15px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
            position: relative;
            text-align: center;
            animation: fadeInZoom 0.3s ease-out;
        }

        @keyframes fadeInZoom {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }

        .modal-content h3 {
            color: #007bff;
            margin-top: 0;
        }

        .modal-content input[type="number"] {
            width: calc(100% - 40px);
            padding: 12px;
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1.1em;
        }

        .modal .close-button {
            color: #aaa;
            position: absolute;
            right: 20px;
            top: 10px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .modal .close-button:hover,
        .modal .close-button:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        .hidden {
            display: none !important;
        }

        hr {
            border: 0;
            height: 1px;
            background-image: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0));
            margin: 40px 0;
        }

        /* Status styles */
        .status {
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: bold;
            font-size: 0.9em;
        }
        
        .status.active {
            background-color: #d4edda;
            color: #155724;
        }
        
        .status.pending-admin-approval {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .status.approved {
            background-color: #d1ecf1;
            color: #0c5460;
        }
        
        .status.rejected {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .status.completed {
            background-color: #d4edda;
            color: #155724;
        }

        /* Notification styles */
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        /* Responsive Design */
        @media (max-width: 992px) {
            .hero-section {
                flex-direction: column;
                text-align: center;
            }
            .hero-content, .hero-graphics {
                max-width: 100%;
            }
            .main-header {
                flex-direction: column;
                padding: 15px;
            }
            .main-header nav ul {
                margin-top: 15px;
                flex-wrap: wrap;
                justify-content: center;
            }
            .main-header nav ul li {
                margin: 5px 15px;
            }
            .auth-buttons {
                margin-top: 15px;
            }
            .dashboard-content {
                flex-direction: column;
            }
            .sidebar {
                width: 100%;
                padding: 15px;
            }
            .dashboard-nav ul {
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
            }
            .dashboard-nav ul li {
                margin: 5px 10px;
            }
            .main-dashboard-area {
                padding: 20px;
            }
            .package-grid, .contact-methods {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            }
        }

        @media (max-width: 768px) {
            h1 { font-size: 2.5em; }
            h2 { font-size: 2em; }
            .hero-content .motto {
                font-size: 2.8em;
            }
            .hero-content .mission {
                font-size: 1em;
            }
            .work-process .step {
                width: 100%;
            }
            .auth-page form {
                padding: 30px;
            }
            .dashboard-header {
                flex-direction: column;
                align-items: flex-start;
            }
            .dashboard-header .header-right {
                width: 100%;
                justify-content: space-between;
                margin-top: 15px;
            }
            .dashboard-header .logo {
                margin-bottom: 10px;
            }
            .dashboard-header .user-info {
                font-size: 1em;
                margin-bottom: 10px;
            }
            .data-table th, .data-table td {
                font-size: 0.9em;
                padding: 8px 10px;
            }
        }

        @media (max-width: 480px) {
            .main-header {
                padding: 10px;
            }
            .main-header .logo h1 {
                font-size: 1.5em;
            }
            .main-header nav ul li {
                margin: 5px 8px;
                font-size: 0.9em;
            }
            .hero-section {
                padding: 30px 20px;
            }
            .hero-content .motto {
                font-size: 2em;
            }
            .hero-content .mission {
                font-size: 1em;
            }
            .btn {
                padding: 10px 20px;
                font-size: 1em;
            }
            .auth-page form {
                padding: 20px;
            }
            .deposit-method {
                flex: 1 1 100%;
            }
            .package-card {
                padding: 20px;
            }
            .deposit-method .payment-logo {
                width: 80px;
                height: 80px;
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <section id="welcome-page" class="active-page">
            <header class="main-header">
                <div class="logo">
                    <img src="https://www.brandbucket.com/sites/default/files/logo_uploads/328122/large_dailyearners_0.png"
                         alt="DailyEarners Logo"
                         onerror="this.onerror=null; this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAiIGhlaWdodD0iNTAiIHZpZXdCb3g9IjAgMCA1MCA1MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjUiIGN5PSIyNSIgcj0iMjUiIGZpbGw9IiMwMDdiZmYiLz4KPHRleHQgeD0iMjUiIHk9IjMwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSJ3aGl0ZSIgZm9udC1zaXplPSIxMiIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXdlaWdodD0iYm9sZCI+REU8L3RleHQ+Cjwvc3ZnPg=='; this.style.display='block';">
                    <h1>DailyEarners</h1>
                </div>
                <nav>
                    <ul>
                        <li><a href="#" onclick="showPage('welcome-page')">Home</a></li>
                        <li><a href="#" onclick="showPage('packages-section')">Investments</a></li>
                        <li><a href="#" onclick="showPage('how-we-work-section')">How We Work</a></li>
                        <li><a href="#" onclick="showPage('contact-section')">Contact</a></li>
                    </ul>
                </nav>
                <div class="auth-buttons">
                    <button class="btn btn-login" onclick="showPage('login-page')">Login</button>
                    <button class="btn btn-register" onclick="showPage('register-page')">Register</button>
                </div>
            </header>
            <main class="hero-section">
                <div class="hero-content">
                    <h2 class="motto">Invest Smart, Earn Daily, Secure Your Future.</h2>
                    <p class="mission">At DailyEarners, we empower every individual to achieve financial freedom. Through strategic trading and smart stock investments, we provide a secure and transparent platform for you to grow your wealth, daily. Join us in 2025 and build your legacy!</p>
                    <button class="btn btn-primary" onclick="showPage('register-page')">Get Started Now</button>
                </div>
                <div class="hero-graphics">
                    <img id="hero-image" src="https://www.vecteezy.com/vector-art/24813386-stock-market-growth-in-futuristic-technology-style-successful-financial-graphic-on-blue-background-business-growth-illustration-with-the-bar-chart-static-and-up-arrow" alt="Stock Market Growth">
                </div>
            </main>

            <section id="how-we-work-section" class="info-section">
                <h2>How We Generate Money</h2>
                <div class="work-process">
                    <div class="step">
                        <i class="fas fa-chart-line icon-large"></i>
                        <h3>Strategic Trading</h3>
                        <p>Our expert traders analyze market trends and execute profitable trades in various financial instruments.</p>
                    </div>
                    <div class="step">
                        <i class="fas fa-sack-dollar icon-large"></i>
                        <h3>Smart Stock Investments</h3>
                        <p>We invest in high-growth potential stocks, diversifying portfolios for optimal returns.</p>
                    </div>
                    <div class="step">
                        <i class="fas fa-handshake icon-large"></i>
                        <h3>Profit Sharing</h3>
                        <p>A portion of the generated profits is distributed to our valued investors daily, based on their chosen package.</p>
                    </div>
                </div>
            </section>
        </section>

        <section id="register-page" class="auth-page">
            <button class="back-btn" onclick="showPage('welcome-page')"><i class="fas fa-arrow-left"></i> Back</button>
            <h2>Register Your Account</h2>

            <div style="text-align: center; margin-bottom: 20px;">
                <button type="button" class="btn btn-google" onclick="signInWithGoogle()">
                    <i class="fab fa-google"></i> Sign up with Google
                </button>
            </div>

            <div class="auth-divider">
                <span>Or continue with email</span>
            </div>

            <form id="registration-form">
                <div class="form-group">
                    <label for="reg-username">Username:</label>
                    <input type="text" id="reg-username" name="username" required>
                    <span class="error-message" id="reg-username-error"></span>
                </div>
                <div class="form-group">
                    <label for="reg-email">Email:</label>
                    <input type="email" id="reg-email" name="email" required>
                    <span class="error-message" id="reg-email-error"></span>
                </div>
                <div class="form-group">
                    <label for="reg-phone">Telephone Number:</label>
                    <input type="tel" id="reg-phone" name="phone" required>
                    <span class="error-message" id="reg-phone-error"></span>
                </div>
                <div class="form-group">
                    <label for="reg-password">Password:</label>
                    <input type="password" id="reg-password" name="password" required>
                    <span class="password-toggle" onclick="togglePassword('reg-password')"><i class="fas fa-eye"></i></span>
                    <span class="error-message" id="reg-password-error"></span>
                </div>
                <div class="form-group">
                    <label for="reg-confirm-password">Confirm Password:</label>
                    <input type="password" id="reg-confirm-password" name="confirm_password" required>
                    <span class="password-toggle" onclick="togglePassword('reg-confirm-password')"><i class="fas fa-eye"></i></span>
                    <span class="error-message" id="reg-confirm-password-error"></span>
                </div>
                <button type="submit" class="btn btn-primary">Sign Up</button>
                <p class="auth-link">Already have an account? <a href="#" onclick="showPage('login-page')">Login</a></p>
            </form>


            <div id="welcome-bonus-section" class="welcome-bonus-claim" style="display: none; margin-top: 30px; text-align: center;">
                <div style="background: linear-gradient(135deg, #28a745, #20c997); padding: 25px; border-radius: 15px; box-shadow: 0 8px 25px rgba(40, 167, 69, 0.3);">
                    <h3 style="margin: 0 0 15px 0; color: white; font-size: 1.5em;"><i class="fas fa-gift"></i> Welcome Bonus!</h3>
                    <p style="margin: 0 0 20px 0; font-size: 1.1em; color: white;">🎉 Congratulations on joining DailyEarners! Your welcome bonus of UGX 4,000 has been automatically added to your account balance.</p>
                    <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 10px; margin: 15px 0;">
                        <p style="margin: 0; font-size: 1.2em; color: white; font-weight: bold;">
                            <i class="fas fa-coins"></i> UGX 4,000 Added to Your Balance!
                        </p>
                    </div>
                    <p style="margin: 15px 0 0 0; font-size: 0.9em; color: rgba(255,255,255,0.8);">
                        <i class="fas fa-info-circle"></i> This welcome bonus helps you get started with your investments
                    </p>
                </div>
            </div>

            <!-- Firebase Configuration Troubleshooting -->
            <div id="firebase-troubleshooting" style="display: none; margin-top: 20px;">
                <div style="background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; padding: 15px; border-radius: 8px;">
                    <h4 style="margin: 0 0 10px 0;"><i class="fas fa-exclamation-triangle"></i> Authentication Issues Detected</h4>
                    <p style="margin: 0 0 10px 0; font-size: 0.9em;">We're detecting Firebase configuration issues. Here's how to fix them:</p>

                    <div style="text-align: left; font-size: 0.85em;">
                        <strong>🔐 For Google Sign-In ("unauthorized domain"):</strong>
                        <ol style="margin: 5px 0; padding-left: 20px;">
                            <li>Go to <a href="https://console.firebase.google.com/" target="_blank" style="color: #721c24;">Firebase Console</a></li>
                            <li>Select your project: <code>dailyearners1</code></li>
                            <li>Navigate to: Authentication → Settings → Authorized Domains</li>
                            <li>Add your current domain: <code id="current-domain">localhost</code></li>
                        </ol>

                    </div>

                    <div style="margin-top: 10px; text-align: center;">
                        <button onclick="hideTroubleshooting()" class="btn btn-danger" style="font-size: 0.8em; padding: 8px 16px;">Got it</button>
                        <button onclick="fixFirebaseConfig()" class="btn btn-info" style="font-size: 0.8em; padding: 8px 16px; margin-left: 10px;">Show Details</button>
                    </div>
                </div>
            </div>
        </section>

        <section id="login-page" class="auth-page">
            <button class="back-btn" onclick="showPage('welcome-page')"><i class="fas fa-arrow-left"></i> Back</button>
            <h2>Login to Your Account</h2>

            <div style="text-align: center; margin-bottom: 20px;">
                <button type="button" class="btn btn-google" onclick="signInWithGoogle()">
                    <i class="fab fa-google"></i> Sign in with Google
                </button>
            </div>

            <div class="auth-divider">
                <span>Or continue with email</span>
            </div>

            <form id="login-form">
                <div class="form-group">
                    <label for="login-username-email">Username or Email:</label>
                    <input type="text" id="login-username-email" name="username_email" required>
                    <span class="error-message" id="login-username-email-error"></span>
                </div>
                <div class="form-group">
                    <label for="login-password">Password:</label>
                    <input type="password" id="login-password" name="password" required>
                    <span class="password-toggle" onclick="togglePassword('login-password')"><i class="fas fa-eye"></i></span>
                    <span class="error-message" id="login-password-error"></span>
                </div>
                <p class="forgot-password"><a href="#" onclick="showPage('forgot-password-page')">Forgot Password?</a></p>
                <button type="submit" class="btn btn-primary">Login</button>
                <p class="auth-link">Don't have an account? <a href="#" onclick="showPage('register-page')">Register</a></p>
            </form>
        </section>

        <section id="forgot-password-page" class="auth-page">
            <button class="back-btn" onclick="showPage('login-page')"><i class="fas fa-arrow-left"></i> Back</button>
            <h2>Reset Your Password</h2>
            <p>Enter your registered email address to receive a password reset link.</p>
            <form id="forgot-password-form">
                <div class="form-group">
                    <label for="forgot-email">Email:</label>
                    <input type="email" id="forgot-email" name="email" required>
                    <span class="error-message" id="forgot-email-error"></span>
                </div>
                <button type="submit" class="btn btn-primary">Reset Password</button>
            </form>
        </section>

        <section id="packages-section" class="info-section">
            <button class="back-btn" onclick="showPage('welcome-page')"><i class="fas fa-arrow-left"></i> Back to Home</button>
            <h2>Investment Packages</h2>
            <p>Choose from our range of carefully designed investment packages to start your journey towards financial freedom.</p>

            <div class="package-grid">
                <div class="package-card">
                    <h3>Basic Plan</h3>
                    <p class="range">UGX 10,000 - 40,000</p>
                    <p class="earning">Daily Earning: <span>5%</span></p>
                    <p class="duration">Duration: 21 Days</p>
                    <button class="btn btn-apply" onclick="showInvestmentModal('Basic Plan', 10000, 40000, 0.05)">Apply Now</button>
                </div>
                <div class="package-card">
                    <h3>Standard Plan</h3>
                    <p class="range">UGX 50,000 - 90,000</p>
                    <p class="earning">Daily Earning: <span>8%</span></p>
                    <p class="duration">Duration: 21 Days</p>
                    <button class="btn btn-apply" onclick="showInvestmentModal('Standard Plan', 50000, 90000, 0.08)">Apply Now</button>
                </div>
                <div class="package-card">
                    <h3>Premium VIP</h3>
                    <p class="range">UGX 100,000 - 200,000</p>
                    <p class="earning">Daily Earning: <span>10%</span></p>
                    <p class="duration">Duration: 21 Days</p>
                    <button class="btn btn-apply" onclick="showInvestmentModal('Premium VIP', 100000, 200000, 0.10)">Apply Now</button>
                </div>
                <div class="package-card">
                    <h3>Fixed Deposit (30 Days)</h3>
                    <p class="range">UGX 300,000 - 499,999</p>
                    <p class="earning">Daily Earning: <span>15%</span></p>
                    <p class="duration">Duration: 25 Days</p>
                    <button class="btn btn-apply" onclick="showInvestmentModal('Fixed Deposit (30 Days)', 300000, 499999, 0.15)">Apply Now</button>
                </div>
                <div class="package-card">
                    <h3>Fixed Deposit (60 Days)</h3>
                    <p class="range">UGX 500,000 - 1,500,000</p>
                    <p class="earning">Daily Earning: <span>15%</span></p>
                    <p class="duration">Duration: 30 Days</p>
                    <button class="btn btn-apply" onclick="showInvestmentModal('Fixed Deposit (60 Days)', 500000, 1500000, 0.15)">Apply Now</button>
                </div>
                <div class="package-card">
                    <h3>Elite Fixed Deposit</h3>
                    <p class="range">UGX 1,600,000 - 3,000,000</p>
                    <p class="earning">Daily Earning: <span>15%</span></p>
                    <p class="duration">Duration: 60 Days</p>
                    <button class="btn btn-apply" onclick="showInvestmentModal('Elite Fixed Deposit', 1600000, 3000000, 0.15)">Apply Now</button>
                </div>
            </div>
        </section>

        <section id="contact-section" class="info-section">
            <button class="back-btn" onclick="showPage('welcome-page')"><i class="fas fa-arrow-left"></i> Back to Home</button>
            <h2>Contact Us</h2>
            <p>Get in touch with our customer support team for any inquiries or assistance.</p>

            <div class="contact-methods">
                <div class="contact-card">
                    <i class="fab fa-whatsapp icon-large whatsapp-color"></i>
                    <h3>WhatsApp Support</h3>
                    <p>Chat with us instantly</p>
                    <a href="https://wa.me/256749846848" target="_blank" class="btn btn-whatsapp">0749846848</a>
                </div>
                <div class="contact-card">
                    <i class="fab fa-telegram-plane icon-large telegram-color"></i>
                    <h3>Telegram Support</h3>
                    <p>Connect on Telegram</p>
                    <a href="https://t.me/+256706571957" target="_blank" class="btn btn-telegram">+256706571957</a>
                </div>
                <div class="contact-card">
                    <i class="fas fa-envelope icon-large email-color"></i>
                    <h3>Email Support</h3>
                    <p>Send us an email</p>
                    <a href="mailto:dailyearners1234@gmail.com" class="btn btn-email">dailyearners1234@gmail.com</a>
                </div>
                <div class="contact-card">
                    <i class="fas fa-map-marker-alt icon-large location-color"></i>
                    <h3>Our Office</h3>
                    <p>Visit us at:</p>
                    <p><strong>Bugubugu Arcade, Block 15, Edition 4</strong></p>
                    <p>Kampala, Uganda</p>
                </div>
            </div>

            <div style="margin-top: 40px; text-align: center;">
                <p><strong>Business Hours:</strong> Monday - Friday: 8:00 AM - 6:00 PM</p>
                <p><strong>Customer Support:</strong> Available 24/7 via WhatsApp and Telegram</p>
            </div>
        </section>

        <section id="dashboard-page" class="dashboard-section" style="display: none;">
            <header class="dashboard-header">
                <div class="header-left">
                    <div class="logo">
                        <img src="https://www.brandbucket.com/sites/default/files/logo_uploads/328122/large_dailyearners_0.png"
                             alt="DailyEarners Logo"
                             onerror="this.onerror=null; this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMjAiIGZpbGw9IiMwMDAwMDAwIiBmb250LXNpemU9IjI0IiBmb250LWZhbWlseT0iQXJpYWwsIHNhbnMtc2VyaWYiIGZvbnQtd2VpZ2h0PSJib2xkIj5NV04gPC90ZXh0Pgo8L3N2Zz4='; this.style.display='block';">
                        <h3>DailyEarners</h3>
                    </div>
                    <div class="user-info">
                        <span id="welcome-message"></span>
                        <span id="account-balance">Current Balance: UGX 0</span>
                    </div>
                </div>
                <div class="header-right">
                    <!-- Welcome bonus display removed since bonus is now automatic -->
                    <button class="btn btn-logout" onclick="logoutUser()">Logout <i class="fas fa-sign-out-alt"></i></button>
                </div>
            </header>

            <div class="dashboard-content">
                <aside class="sidebar">
                    <nav class="dashboard-nav">
                        <ul>
                            <li><a href="#" class="nav-item active" data-target="my-account-tab"><i class="fas fa-user"></i> My Account</a></li>
                            <li><a href="#" class="nav-item" data-target="investment-packages-tab"><i class="fas fa-hand-holding-usd"></i> Investment Packages</a></li>
                            <li><a href="#" class="nav-item" data-target="my-investments-tab"><i class="fas fa-chart-area"></i> My Investments</a></li>
                            <li><a href="#" class="nav-item" data-target="deposit-tab"><i class="fas fa-money-bill-transfer"></i> Deposit</a></li>
                            <li><a href="#" class="nav-item" data-target="withdraw-tab"><i class="fas fa-wallet"></i> Withdraw</a></li>
                            <li><a href="#" class="nav-item" data-target="referrals-tab"><i class="fas fa-user-group"></i> Referrals</a></li>
                            <li><a href="#" class="nav-item" data-target="customer-care-tab"><i class="fas fa-headset"></i> Customer Care</a></li>
                        </ul>
                    </nav>
                </aside>

                <main class="main-dashboard-area">
                    <div id="my-account-tab" class="dashboard-tab-content active">
                        <h2>My Account Details</h2>
                        <p><strong>Username:</strong> <span id="display-username"></span></p>
                        <p><strong>Email:</strong> <span id="display-email"></span></p>
                        <p><strong>Phone:</strong> <span id="display-phone"></span></p>
                        <p><strong>Account Balance:</strong> <span id="display-account-balance-account">UGX 0</span></p>
                    </div>

                    <div id="investment-packages-tab" class="dashboard-tab-content">
                        <h2>Choose Your Investment Plan</h2>
                        <div class="package-grid">
                            <div class="package-card">
                                <h3>Basic Plan</h3>
                                <p class="range">UGX 10,000 - 40,000</p>
                                <p class="earning">Daily Earning: <span>5%</span></p>
                                <p class="duration">Duration: 21 Days</p>
                                <button class="btn btn-apply" onclick="showInvestmentModal('Basic Plan', 10000, 40000, 0.05)">Apply Now</button>
                            </div>
                            <div class="package-card">
                                <h3>Standard Plan</h3>
                                <p class="range">UGX 50,000 - 90,000</p>
                                <p class="earning">Daily Earning: <span>8%</span></p>
                                <p class="duration">Duration: 21 Days</p>
                                <button class="btn btn-apply" onclick="showInvestmentModal('Standard Plan', 50000, 90000, 0.08)">Apply Now</button>
                            </div>
                            <div class="package-card">
                                <h3>Premium VIP</h3>
                                <p class="range">UGX 100,000 - 200,000</p>
                                <p class="earning">Daily Earning: <span>10%</span></p>
                                <p class="duration">Duration: 21 Days</p>
                                <button class="btn btn-apply" onclick="showInvestmentModal('Premium VIP', 100000, 200000, 0.10)">Apply Now</button>
                            </div>
                            <div class="package-card">
                                <h3>Fixed Deposit (30 Days)</h3>
                                <p class="range">UGX 300,000 - 499,999</p>
                                <p class="earning">Daily Earning: <span>15%</span></p>
                                <p class="duration">Duration: 25 Days</p>
                                <button class="btn btn-apply" onclick="showInvestmentModal('Fixed Deposit (30 Days)', 300000, 499999, 0.15)">Apply Now</button>
                            </div>
                            <div class="package-card">
                                <h3>Fixed Deposit (60 Days)</h3>
                                <p class="range">UGX 500,000 - 1,500,000</p>
                                <p class="earning">Daily Earning: <span>15%</span></p>
                                <p class="duration">Duration: 30 Days</p>
                                <button class="btn btn-apply" onclick="showInvestmentModal('Fixed Deposit (60 Days)', 500000, 1500000, 0.15)">Apply Now</button>
                            </div>
                            <div class="package-card">
                                <h3>Elite Fixed Deposit</h3>
                                <p class="range">UGX 1,600,000 - 3,000,000</p>
                                <p class="earning">Daily Earning: <span>15%</span></p>
                                <p class="duration">Duration: 60 Days</p>
                                <button class="btn btn-apply" onclick="showInvestmentModal('Elite Fixed Deposit', 1600000, 3000000, 0.15)">Apply Now</button>
                            </div>
                        </div>
                    </div>

                    <div id="my-investments-tab" class="dashboard-tab-content">
                        <h2>Your Investment Overview</h2>

                        <!-- Balance Summary -->
                        <div style="background: linear-gradient(135deg, #007bff, #0056b3); color: white; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                            <h3 style="margin: 0 0 15px 0;"><i class="fas fa-wallet"></i> Account Balance</h3>
                            <p style="font-size: 1.5em; margin: 0; font-weight: bold;">UGX <span id="investment-balance-display">0</span></p>
                            <p style="margin: 5px 0 0 0; opacity: 0.9; font-size: 0.9em;">Available for new investments</p>
                        </div>

                        <!-- Investment Summary -->
                        <div style="background: linear-gradient(135deg, #28a745, #20c997); color: white; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                            <h3 style="margin: 0 0 15px 0;"><i class="fas fa-chart-line"></i> Investment Summary</h3>
                            <div style="display: flex; gap: 20px;">
                                <div>
                                    <p style="margin: 0; font-size: 1.1em;">Total Invested: <strong>UGX <span id="total-invested-display">0</span></strong></p>
                                </div>
                                <div>
                                    <p style="margin: 0; font-size: 1.1em;">Active Investments: <strong><span id="active-investments-count">0</span></strong></p>
                                </div>
                            </div>
                        </div>

                        <h3>Your Active Investments</h3>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Plan Name</th>
                                    <th>Invested Amount</th>
                                    <th>Daily Earning Rate</th>
                                    <th>Start Date</th>
                                    <th>End Date</th>
                                    <th>Remaining Time</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="investments-table-body">
                                <tr>
                                    <td colspan="7">No active investments yet.</td>
                                </tr>
                            </tbody>
                        </table>

                        <!-- Deposit Information for Investments -->
                        <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 10px; border-left: 4px solid #007bff;">
                            <h4><i class="fas fa-info-circle"></i> Investment Funding</h4>
                            <p>Your investments are funded from your account balance, which includes:</p>
                            <ul style="margin: 10px 0; padding-left: 20px;">
                                <li><strong>Welcome Bonus:</strong> UGX 4,000 (automatically added to new accounts)</li>
                                <li><strong>Deposits:</strong> Funds from Mobile Money deposits</li>
                                <li><strong>Investment Returns:</strong> Profits from completed investments</li>
                            </ul>
                            <p style="margin-bottom: 0;"><em>When you make an investment, the amount is deducted from your available balance and locked until the investment completes.</em></p>
                        </div>
                    </div>

                    <div id="deposit-tab" class="dashboard-tab-content">
                        <h2>Deposit Funds</h2>
                        <p class="min-max-info">Min Deposit: UGX 10,000 | Max Deposit: UGX 3,000,000</p>
                        <div class="deposit-options">
                            <div class="deposit-method">
                                <img src="https://logos-world.net/wp-content/uploads/2020/11/Airtel-Logo.png" alt="Airtel Money Logo" class="payment-logo" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiByeD0iMTUiIGZpbGw9IiNkYzE0M2MiLz4KPHRleHQgeD0iNTAiIHk9IjU4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSJ3aGl0ZSIgZm9udC1zaXplPSIyMCIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXdlaWdodD0iYm9sZCI+YWlydGVsPC90ZXh0Pgo8L3N2Zz4='">
                                <h3>Airtel Money</h3>
                                <p>Send money to: <strong>0746160623 (Kisakye Reagan)</strong></p>
                                <form class="deposit-form" data-method="Airtel">
                                    <div class="form-group">
                                        <label for="airtel-amount">Amount (UGX):</label>
                                        <input type="number" id="airtel-amount" min="10000" max="3000000" required>
                                        <span class="error-message" id="airtel-amount-error"></span>
                                    </div>
                                    <div class="form-group">
                                        <label for="airtel-transaction-id">Transaction ID:</label>
                                        <input type="text" id="airtel-transaction-id" required>
                                        <span class="error-message" id="airtel-transaction-id-error"></span>
                                    </div>
                                    <button type="submit" class="btn btn-success">Confirm Deposit</button>
                                </form>
                            </div>

                            <div class="deposit-method">
                                <img src="https://uxwing.com/wp-content/themes/uxwing/download/brands-and-social-media/mtn-mobile-logo-icon.svg" alt="MTN Mobile Money Logo" class="payment-logo" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiByeD0iMTUiIGZpbGw9IiNmZmMxMDciLz4KPHRleHQgeD0iNTAiIHk9IjU4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjMDAwMDAwMCIgZm9udC1zaXplPSIyNCIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXdlaWdodD0iYm9sZCI+TVROIDwvdGV4dD4KPC9zdmc+'">
                                <h3>MTN Mobile Money</h3>
                                <p>Send money to: <strong>0746160623 (Kisakye Reagan)</strong></p>
                                <form class="deposit-form" data-method="MTN">
                                    <div class="form-group">
                                        <label for="mtn-amount">Amount (UGX):</label>
                                        <input type="number" id="mtn-amount" min="10000" max="3000000" required>
                                        <span class="error-message" id="mtn-amount-error"></span>
                                    </div>
                                    <div class="form-group">
                                        <label for="mtn-transaction-id">Transaction ID:</label>
                                        <input type="text" id="mtn-transaction-id" required>
                                        <span class="error-message" id="mtn-transaction-id-error"></span>
                                    </div>
                                    <button type="submit" class="btn btn-success">Confirm Deposit</button>
                                </form>
                            </div>
                        </div>

                        <hr>
                        <h3>Deposit History</h3>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Amount</th>
                                    <th>Method</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="deposit-history-body">
                                <tr>
                                    <td colspan="4">No deposit history.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div id="withdraw-tab" class="dashboard-tab-content">
                        <h2>Withdraw Funds</h2>
                        <p class="min-max-info">Min Withdrawal: UGX 7,000</p>
                        <form id="withdrawal-form">
                            <div class="form-group">
                                <label for="withdraw-amount">Amount (UGX):</label>
                                <input type="number" id="withdraw-amount" min="7000" required>
                                <span class="error-message" id="withdraw-amount-error"></span>
                            </div>
                            <div class="form-group">
                                <label for="withdraw-method">Withdrawal Method:</label>
                                <select id="withdraw-method" required>
                                    <option value="">Select Method</option>
                                    <option value="Airtel Money">Airtel Money</option>
                                    <option value="MTN Mobile Money">MTN Mobile Money</option>
                                </select>
                                <span class="error-message" id="withdraw-method-error"></span>
                            </div>
                            <div class="form-group">
                                <label for="withdraw-number">Mobile Money Number:</label>
                                <input type="tel" id="withdraw-number" required>
                                <span class="error-message" id="withdraw-number-error"></span>
                            </div>
                            <button type="submit" class="btn btn-danger">Request Withdrawal</button>
                        </form>

                        <hr>
                        <h3>Withdrawal History</h3>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Amount</th>
                                    <th>Method</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="withdraw-history-body">
                                <tr>
                                    <td colspan="4">No withdrawal history.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div id="referrals-tab" class="dashboard-tab-content">
                        <h2>Referral Program</h2>
                        <p>Share your unique referral code and link to earn bonuses!</p>
                        <div class="referral-info">
                            <p>Your Referral Code: <strong id="referral-code-display">DAILYEARNERSUSER123</strong></p>
                            <p>Your Referral Link: <a href="https://dailyearners.com/username" id="referral-link-display" target="_blank">dailyearners.com/username</a></p>
                            <button class="btn btn-copy" onclick="copyReferralLink()">Copy Link <i class="fas fa-copy"></i></button>
                        </div>

                        <h3>Referral Bonus Structure (10% on first deposit)</h3>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Amount Invested by Referral</th>
                                    <th>Your Bonus (10%)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td>UGX 10,000</td><td>UGX 1,000</td></tr>
                                <tr><td>UGX 50,000</td><td>UGX 5,000</td></tr>
                                <tr><td>UGX 100,000</td><td>UGX 10,000</td></tr>
                                <tr><td>UGX 500,000</td><td>UGX 50,000</td></tr>
                                <tr><td>UGX 1,000,000</td><td>UGX 100,000</td></tr>
                                <tr><td>UGX 3,000,000</td><td>UGX 300,000</td></tr>
                            </tbody>
                        </table>

                        <h3 style="margin-top: 30px;">My Referrals</h3>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Referred User</th>
                                    <th>Date Joined</th>
                                    <th>Total Investment by Referral</th>
                                    <th>Your Earned Bonus</th>
                                </tr>
                            </thead>
                            <tbody id="my-referrals-table-body">
                                <tr><td colspan="4">No referrals yet.</td></tr>
                            </tbody>
                        </table>
                    </div>

                    <div id="customer-care-tab" class="dashboard-tab-content">
                        <h2>Customer Care & Support</h2>
                        <div class="contact-methods">
                            <div class="contact-card">
                                <i class="fab fa-whatsapp icon-large whatsapp-color"></i>
                                <h3>WhatsApp Support</h3>
                                <p>Chat with us instantly:</p>
                                <a href="https://wa.me/256749846848" target="_blank" class="btn btn-whatsapp">0749846848</a>
                            </div>
                            <div class="contact-card">
                                <i class="fab fa-telegram-plane icon-large telegram-color"></i>
                                <h3>Telegram Support</h3>
                                <p>Connect on Telegram:</p>
                                <a href="https://t.me/+256706571957" target="_blank" class="btn btn-telegram">+256706571957</a>
                            </div>
                            <div class="contact-card">
                                <i class="fas fa-envelope icon-large email-color"></i>
                                <h3>Email Support</h3>
                                <p>Send us an email:</p>
                                <a href="mailto:dailyearners1234@gmail.com" class="btn btn-email">dailyearners1234@gmail.com</a>
                            </div>
                            <div class="contact-card">
                                <i class="fas fa-map-marker-alt icon-large location-color"></i>
                                <h3>Our Office</h3>
                                <p>Kampala, Uganda</p>
                                <p>Bugubugu Arcade, Block 15, Edition 4</p>
                            </div>
                        </div>
                    </div>

                    <div id="admin-tab" class="dashboard-tab-content" style="display: none;">
                        <h2><i class="fas fa-crown"></i> Admin Panel</h2>
                        <p>Manage transactions and users</p>

                        <div style="margin-bottom: 30px;">
                            <button onclick="showAdminTab('pending-deposits')" class="btn btn-primary">Pending Deposits</button>
                            <button onclick="showAdminTab('pending-withdrawals')" class="btn btn-info">Pending Withdrawals</button>
                            <button onclick="testAdminFunctions()" class="btn btn-warning" style="margin-left: 10px;">Debug/Test Functions</button>
                            <button onclick="testFirebasePermissions()" class="btn btn-secondary" style="margin-left: 5px;">Test Permissions</button>
                            <button onclick="forceRefreshAdminData()" class="btn btn-info" style="margin-left: 5px;">🔄 Force Refresh</button>
                            <button onclick="testBalanceFunctionality()" class="btn btn-success" style="margin-left: 5px;" title="Test balance validation and calculations">🧪 Test Balance</button>
                            <button onclick="diagnoseFirebaseAuth()" class="btn btn-warning" style="margin-left: 5px;" title="Diagnose Firebase authentication issues">🔧 Diagnose Auth</button>
                            <button onclick="fixFirebaseConfig()" class="btn btn-info" style="margin-left: 5px;" title="Show Firebase configuration fix instructions">⚙️ Config Help</button>
                            <button onclick="testRecaptcha()" class="btn btn-success" style="margin-left: 5px;" title="Test Google Sign-In functionality">🔐 Test Google Auth</button>
                            <button onclick="testUserSpecificFiltering()" class="btn btn-info" style="margin-left: 5px;" title="Test that users only see their own investments">👤 Test User Filtering</button>
                        </div>

                        <div id="pending-deposits-tab" class="admin-tab-content" style="display: block;">
                            <h3>Pending Deposits</h3>
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>User</th>
                                        <th>Amount</th>
                                        <th>Method</th>
                                        <th>Transaction ID</th>
                                        <th>Date</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="pending-deposits-body">
                                    <tr><td colspan="6">Loading pending deposits...</td></tr>
                                </tbody>
                            </table>
                        </div>

                        <div id="pending-withdrawals-tab" class="admin-tab-content" style="display: none;">
                            <h3>Pending Withdrawals</h3>
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>User</th>
                                        <th>Amount</th>
                                        <th>Method</th>
                                        <th>Mobile Number</th>
                                        <th>Date</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="pending-withdrawals-body">
                                    <tr><td colspan="6">Loading pending withdrawals...</td></tr>
                                </tbody>
                            </table>
                        </div>

                    </div>
                </main>
            </div>
        </section>

        <div id="investment-modal" class="modal">
            <div class="modal-content">
                <span class="close-button">&times;</span>
                <h3 id="modal-package-name"></h3>
                <p>Enter the amount you wish to invest (UGX):</p>
                <input type="number" id="invest-amount-input" min="10000" max="3000000" required>
                <span class="error-message" id="invest-amount-error"></span>
                <button id="confirm-investment-btn" class="btn btn-primary">Confirm Investment</button>
                <p id="investment-modal-error" class="error-message"></p>
            </div>
        </div>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAI0dIy8bdvHhvX6-CZmHjuqBBUCfKSirA",
            authDomain: "dailyearners1.firebaseapp.com",
            projectId: "dailyearners1",
            storageBucket: "dailyearners1.firebasestorage.app",
            messagingSenderId: "147819078141",
            appId: "1:147819078141:web:c0e37f72a940aa583af994",
            measurementId: "G-6HN7E990TR"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Global state
        const state = {
            user: null,
            balance: 0,
            welcomeBonusAmount: 0, // No longer used since bonus is automatic
            investments: [],
            depositHistory: [],
            withdrawHistory: [],
            referralCode: 'DAILYEARNERSUSER123',
            isLoggedIn: false,
            currentPage: 'welcome-page',
            activeTimers: new Map() // Store active timer references for cleanup
        };

        // Firebase configuration diagnostic function
        function diagnoseFirebaseAuth() {
            console.log('🔧 Firebase Auth Diagnostics:');
            console.log('Current user:', auth.currentUser);
            console.log('Current domain:', window.location.hostname);
            console.log('Firebase config:', {
                apiKey: firebaseConfig.apiKey ? 'Set' : 'Missing',
                authDomain: firebaseConfig.authDomain,
                projectId: firebaseConfig.projectId
            });

            // Check if Google provider is enabled
            auth.fetchSignInMethodsForEmail('test@example.com').then(methods => {
                console.log('Available sign-in methods:', methods);
            }).catch(error => {
                console.log('Error checking sign-in methods:', error);
            });
        }

        // Balance validation utility function
        function validateBalanceOperation(currentBalance, operationAmount, operationType = 'deduct') {
            if (operationType === 'deduct') {
                if (currentBalance - operationAmount < 0) {
                    showNotification(`Insufficient balance. Operation would result in negative balance. Current balance: UGX ${currentBalance.toLocaleString()}`, 'error');
                    return false;
                }
            } else if (operationType === 'set') {
                if (operationAmount < 0) {
                    showNotification('Balance cannot be set to a negative value.', 'error');
                    return false;
                }
            }
            return true;
        }

        // Investment duration validation function
        function validateInvestmentDuration(packageName, startDate, endDate, expectedDurationDays) {
            const now = new Date();
            const start = new Date(startDate);
            const end = new Date(endDate);

            // Check if start date is in the past
            if (start < now && Math.abs(start - now) > 60000) { // Allow 1 minute tolerance for clock differences
                showNotification('Investment start date cannot be in the past.', 'error');
                return false;
            }

            // Check if end date is before start date
            if (end <= start) {
                showNotification('Investment end date must be after the start date.', 'error');
                return false;
            }

            // Calculate actual duration
            const actualDurationMs = end - start;
            const actualDurationDays = Math.ceil(actualDurationMs / (1000 * 60 * 60 * 24));

            // Check if duration is reasonable (not negative, not too long)
            if (actualDurationDays <= 0) {
                showNotification('Investment duration must be at least 1 day.', 'error');
                return false;
            }

            if (actualDurationDays > 90) {
                showNotification('Investment duration cannot exceed 90 days.', 'error');
                return false;
            }

            // Check if duration matches expected duration for the package
            const durationTolerance = 1; // Allow 1 day tolerance
            if (Math.abs(actualDurationDays - expectedDurationDays) > durationTolerance) {
                showNotification(`Investment duration (${actualDurationDays} days) does not match the expected duration for ${packageName} (${expectedDurationDays} days).`, 'error');
                return false;
            }

            return {
                isValid: true,
                actualDurationDays: actualDurationDays,
                startDate: start,
                endDate: end
            };
        }

        // UI Functions
        function showPage(pageId) {
            console.log('showPage called with:', pageId);

            // Check authentication for protected pages
            if (pageId === 'dashboard-page' && !state.isLoggedIn && !auth.currentUser) {
                alert('Please login to access the dashboard.');
                showPage('login-page');
                return;
            }
            
            // Hide all sections
            document.querySelectorAll('section').forEach(section => {
                section.classList.remove('active-page');
                section.style.display = 'none';
            });
            
            // Show target section
            const targetSection = document.getElementById(pageId);
            if (targetSection) {
                targetSection.classList.add('active-page');
                targetSection.style.display = 'flex';
            }
            
            // Handle special cases
            if (pageId === 'dashboard-page') {
                const defaultTab = document.querySelector('.dashboard-nav .nav-item.active');
                if (defaultTab) {
                    showDashboardTab(defaultTab.dataset.target);
                } else {
                    showDashboardTab('my-account-tab');
                }
            }
            
            state.currentPage = pageId;
        }

        function togglePassword(id) {
            const input = document.getElementById(id);
            if (input) {
                const icon = input.nextElementSibling?.querySelector('i');
                if (input.type === 'password') {
                    input.type = 'text';
                    if (icon) {
                        icon.classList.remove('fa-eye');
                        icon.classList.add('fa-eye-slash');
                    }
                } else {
                    input.type = 'password';
                    if (icon) {
                        icon.classList.remove('fa-eye-slash');
                        icon.classList.add('fa-eye');
                    }
                }
            }
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 25px;
                border-radius: 8px;
                color: white;
                font-weight: bold;
                z-index: 9999;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                animation: slideIn 0.3s ease-out;
            `;
            
            if (type === 'error') {
                notification.style.backgroundColor = '#dc3545';
            } else if (type === 'success') {
                notification.style.backgroundColor = '#28a745';
            } else {
                notification.style.backgroundColor = '#007bff';
            }
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease-out';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 5000);
        }

        // Authentication Functions
        async function signInWithGoogle() {
            const googleBtn = document.querySelector('button[onclick="signInWithGoogle()"]');
            if (googleBtn) {
                googleBtn.disabled = true;
                googleBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Signing in...';
            }

            try {
                console.log('🔄 Starting Google Sign-In...');
                console.log('Current domain:', window.location.hostname);

                const provider = new firebase.auth.GoogleAuthProvider();
                provider.addScope('profile');
                provider.addScope('email');

                const result = await auth.signInWithPopup(provider);
                const user = result.user;

                console.log('✅ Google Sign-In successful:', user.email);

                // Check if new user
                const userDoc = await db.collection('users').doc(user.uid).get();

                if (!userDoc.exists) {
                    // New user
                    const username = user.displayName || user.email.split('@')[0];
                    console.log('🆕 Creating new user:', username);

                    await db.collection('users').doc(user.uid).set({
                        username: username,
                        email: user.email,
                        phone: user.phoneNumber || '',
                        balance: 4000, // Welcome bonus automatically added
                        welcomeBonusClaimed: true, // Mark as claimed since it's automatic
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        referralCode: username.toUpperCase() + '123',
                        authProvider: 'google'
                    });

                    // Update state
                    state.user = {
                        uid: user.uid,
                        username: username,
                        email: user.email,
                        phone: user.phoneNumber || ''
                    };
                    state.balance = 4000; // Welcome bonus automatically added
                    state.welcomeBonusAmount = 0; // No need to claim since it's automatic
                    state.isLoggedIn = true;

                    showNotification(`✅ Welcome ${username}! Your account has been created successfully.`, 'success');

                } else {
                    // Existing user
                    const userData = userDoc.data();
                    console.log('🔄 Existing user logging in:', userData.username);

                    // Update state
                    state.user = {
                        uid: user.uid,
                        username: userData.username,
                        email: userData.email,
                        phone: userData.phone || ''
                    };
                    state.balance = userData.balance || 0;
                    state.welcomeBonusAmount = userData.welcomeBonusClaimed ? 0 : 4000;
                    state.isLoggedIn = true;

                    showNotification(`✅ Welcome back, ${userData.username}!`, 'success');
                }

                // Load user data and show dashboard
                await loadUserData();
                await loadUserInvestments();
                await loadUserDeposits();
                await loadUserWithdrawals();
                await loadUserReferrals();

                showPage('dashboard-page');

            } catch (error) {
                console.error('❌ Google Sign-In error:', error);
                let errorMessage = 'Google Sign-In failed. Please try again.';

                if (error.code === 'auth/popup-closed-by-user') {
                    errorMessage = 'Sign-in popup was closed. Please try again.';
                } else if (error.code === 'auth/popup-blocked') {
                    errorMessage = 'Sign-in popup was blocked. Please allow popups for this site and try again.';
                } else if (error.code === 'auth/account-exists-with-different-credential') {
                    errorMessage = 'Account exists with different sign-in method. Please use email/password or phone number.';
                } else if (error.code === 'auth/unauthorized-domain') {
                    errorMessage = 'Unauthorized domain. Please add "' + window.location.hostname + '" to authorized domains in Firebase Console > Authentication > Settings > Authorized Domains.';
                    showTroubleshooting(); // Show troubleshooting help
                } else if (error.code === 'auth/operation-not-allowed') {
                    errorMessage = 'Google Sign-In is not enabled. Please enable it in Firebase Console > Authentication > Sign-in method.';
                } else if (error.code === 'auth/network-request-failed') {
                    errorMessage = 'Network error. Please check your internet connection and try again.';
                } else if (error.code === 'auth/timeout') {
                    errorMessage = 'Request timeout. Please try again.';
                }

                showNotification(errorMessage, 'error');
            } finally {
                // Re-enable button
                if (googleBtn) {
                    googleBtn.disabled = false;
                    googleBtn.innerHTML = '<i class="fab fa-google"></i> Sign up with Google';
                }
            }
        }



        // Phone authentication functions removed - using Google Sign-In only

        // Phone authentication functions removed - using Google Sign-In only

        // Phone authentication functions removed - using Google Sign-In only

        function logoutUser() {
            // Clean up all active timers before logout
            cleanupAllTimers();

            auth.signOut()
                .then(() => {
                    state.user = null;
                    state.balance = 0;
                    state.welcomeBonusAmount = 0;
                    state.investments = [];
                    state.depositHistory = [];
                    state.withdrawHistory = [];
                    state.isLoggedIn = false;

                    document.getElementById('dashboard-page').style.display = 'none';
                    showPage('welcome-page');
                    showNotification('You have been logged out successfully.', 'success');
                })
                .catch((error) => {
                    console.error('Logout error:', error);
                    showNotification(`Logout error: ${error.message}`, 'error');
                });
        }

        // Investment Functions
        function showInvestmentModal(packageName, minAmount, maxAmount, earningRate) {
            if (!state.isLoggedIn) {
                showNotification('Please login to make investments.', 'error');
                showPage('login-page');
                return;
            }

            const modal = document.getElementById('investment-modal');
            const modalPackageName = document.getElementById('modal-package-name');
            const investAmountInput = document.getElementById('invest-amount-input');
            const confirmBtn = document.getElementById('confirm-investment-btn');

            if (!modal || !modalPackageName || !investAmountInput || !confirmBtn) {
                showNotification('Error loading investment modal. Please refresh the page.', 'error');
                return;
            }

            modalPackageName.textContent = packageName;
            investAmountInput.value = '';
            investAmountInput.min = minAmount;
            investAmountInput.max = maxAmount;

            // Clear previous errors
            const amountError = document.getElementById('invest-amount-error');
            const modalError = document.getElementById('investment-modal-error');
            if (amountError) amountError.textContent = '';
            if (modalError) modalError.textContent = '';

            // Show modal
            modal.style.display = 'flex';

            // Remove previous event listener to avoid duplicates
            confirmBtn.onclick = null;
            confirmBtn.onclick = () => confirmInvestment(packageName, minAmount, maxAmount, earningRate);
        }

        async function confirmInvestment(packageName, minAmount, maxAmount, earningRate) {
            const amountInput = document.getElementById('invest-amount-input');
            const amount = parseInt(amountInput.value);
            const errorElement = document.getElementById('invest-amount-error');
            const modalErrorElement = document.getElementById('investment-modal-error');
            const modal = document.getElementById('investment-modal');

            if (!amountInput || !errorElement || !modalErrorElement || !modal) {
                showNotification('Error processing investment. Please try again.', 'error');
                return;
            }

            // Clear previous errors
            errorElement.textContent = '';
            modalErrorElement.textContent = '';

            // Validate amount
            if (!amount || isNaN(amount)) {
                errorElement.textContent = 'Please enter a valid amount.';
                return;
            }

            if (amount < minAmount || amount > maxAmount) {
                errorElement.textContent = `Please enter an amount between UGX ${minAmount.toLocaleString()} and UGX ${maxAmount.toLocaleString()}.`;
                return;
            }

            // Check balance
            if (amount > state.balance) {
                modalErrorElement.textContent = 'Insufficient balance. Please deposit funds first.';
                setTimeout(() => {
                    modal.style.display = 'none';
                    showDashboardTab('deposit-tab');
                }, 2000);
                return;
            }

            // Validate balance operation
            if (!validateBalanceOperation(state.balance, amount, 'deduct')) {
                modalErrorElement.textContent = 'Investment amount cannot exceed your current balance.';
                return;
            }

            // Disable confirm button during processing
            const confirmBtn = document.getElementById('confirm-investment-btn');
            if (confirmBtn) {
                confirmBtn.disabled = true;
                confirmBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
            }

            try {
                // Create investment
                const startDate = new Date();
                let endDate = new Date();

                // Calculate end date based on package type
                const packageDurations = {
                    'Basic Plan': 21,
                    'Standard Plan': 21,
                    'Premium VIP': 21,
                    'Fixed Deposit (30 Days)': 25,
                    'Fixed Deposit (60 Days)': 30,
                    'Elite Fixed Deposit': 60
                };

                const durationDays = packageDurations[packageName] || 21;
                endDate.setDate(startDate.getDate() + durationDays);

                // Validate investment duration
                const durationValidation = validateInvestmentDuration(packageName, startDate, endDate, durationDays);
                if (!durationValidation.isValid) {
                    return; // Error notification already shown by validation function
                }

                const validatedStartDate = durationValidation.startDate;
                const validatedEndDate = durationValidation.endDate;
                const validatedDurationDays = durationValidation.actualDurationDays;

                const newInvestment = {
                    id: Date.now().toString(),
                    planName: packageName,
                    investedAmount: amount,
                    dailyEarningRate: earningRate,
                    startDate: validatedStartDate,
                    endDate: validatedEndDate,
                    durationDays: validatedDurationDays,
                    status: 'Active',
                    userId: state.user.uid,
                    userEmail: state.user.email,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                };

                // Save to Firebase first
                let investmentRef;
                try {
                    investmentRef = await db.collection('investments').add(newInvestment);
                    console.log('Investment saved to Firebase:', investmentRef.id);
                } catch (firebaseError) {
                    console.error('Error saving investment to Firebase:', firebaseError);
                    if (firebaseError.code === 'permission-denied') {
                        showNotification('Permission denied. Please check your account permissions and try again.', 'error');
                    } else if (firebaseError.code === 'unavailable') {
                        showNotification('Service temporarily unavailable. Please try again in a few moments.', 'error');
                    } else {
                        showNotification('Error saving investment. Please try again.', 'error');
                    }
                    return;
                }

                // Update user's balance in Firebase
                try {
                    await db.collection('users').doc(state.user.uid).update({
                        balance: firebase.firestore.FieldValue.increment(-amount)
                    });
                    console.log('User balance updated in Firebase');
                } catch (balanceError) {
                    console.error('Error updating user balance:', balanceError);
                    // Try to rollback the investment
                    try {
                        await investmentRef.delete();
                        console.log('Investment rolled back due to balance update failure');
                    } catch (rollbackError) {
                        console.error('Error rolling back investment:', rollbackError);
                    }

                    if (balanceError.code === 'permission-denied') {
                        showNotification('Permission denied to update balance. Please contact support.', 'error');
                    } else {
                        showNotification('Error updating account balance. Please try again.', 'error');
                    }
                    return;
                }

                // Update local state only after successful Firebase operations
                state.investments.push({ id: investmentRef.id, ...newInvestment });
                state.balance -= amount;

                // Update dashboard
                updateDashboard();

                // Close modal and show success
                modal.style.display = 'none';

                showNotification(`Successfully invested UGX ${amount.toLocaleString()} in ${packageName}! Duration: ${durationDays} days`, 'success');
                showDashboardTab('my-investments-tab');

            } catch (error) {
                console.error('Error processing investment:', error);
                let errorMessage = 'Error processing investment. Please try again.';

                if (error.code === 'permission-denied') {
                    errorMessage = 'Permission denied. Please check your account and try again.';
                } else if (error.code === 'unavailable') {
                    errorMessage = 'Service temporarily unavailable. Please try again later.';
                } else if (error.code === 'deadline-exceeded') {
                    errorMessage = 'Request timeout. Please check your connection and try again.';
                }

                showNotification(errorMessage, 'error');
            } finally {
                // Re-enable button
                if (confirmBtn) {
                    confirmBtn.disabled = false;
                    confirmBtn.innerHTML = 'Confirm Investment';
                }
            }
        }

        function renderInvestments() {
            const tbody = document.getElementById('investments-table-body');
            if (!tbody) return;

            tbody.innerHTML = '';

            if (state.investments.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7">No active investments yet.</td></tr>';
                return;
            }

            state.investments.forEach(inv => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${inv.planName}</td>
                    <td>UGX ${inv.investedAmount.toLocaleString()}</td>
                    <td>${(inv.dailyEarningRate * 100).toFixed(0)}%</td>
                    <td>${inv.startDate ? new Date(inv.startDate).toLocaleDateString() : 'N/A'}</td>
                    <td>${inv.endDate ? new Date(inv.endDate).toLocaleDateString() : 'N/A'}</td>
                    <td id="timer-${inv.id}">Calculating...</td>
                    <td><span class="status ${inv.status ? inv.status.toLowerCase() : 'active'}">${inv.status || 'Active'}</span></td>
                `;

                if ((inv.status === 'Active' || !inv.status)) {
                    startInvestmentTimer(inv);
                }
            });
        }

        async function startInvestmentTimer(investment) {
            // Clear any existing timer for this investment
            const existingTimer = state.activeTimers.get(investment.id);
            if (existingTimer) {
                clearInterval(existingTimer.interval);
                state.activeTimers.delete(investment.id);
            }

            // Validate investment dates before starting timer
            if (!investment.startDate || !investment.endDate) {
                console.error('Invalid investment dates:', investment);
                return;
            }

            let startDate, endDate;
            try {
                startDate = new Date(investment.startDate);
                endDate = new Date(investment.endDate);

                // Validate that dates are valid Date objects
                if (isNaN(startDate.getTime()) || isNaN(endDate.getTime())) {
                    console.error('Invalid date format in investment:', investment);
                    return;
                }

                // Validate that end date is after start date
                if (endDate <= startDate) {
                    console.error('Investment end date is not after start date:', investment);
                    return;
                }
            } catch (dateError) {
                console.error('Error parsing investment dates:', dateError);
                return;
            }

            const updateTimer = async () => {
                try {
                    const now = new Date().getTime();
                    const endTime = endDate.getTime();
                    const distance = endTime - now;
                    const timerElement = document.getElementById(`timer-${investment.id}`);

                    if (!timerElement) {
                        // Timer element no longer exists, clean up
                        clearInterval(timer.interval);
                        state.activeTimers.delete(investment.id);
                        return;
                    }

                    if (distance < 0) {
                        // Investment completed
                        clearInterval(timer.interval);
                        state.activeTimers.delete(investment.id);
                        timerElement.textContent = 'Completed!';
                        investment.status = 'Completed';

                        try {
                            // Calculate actual duration and profit based on validated dates
                            const startTime = startDate.getTime();
                            const actualDurationDays = Math.ceil((endTime - startTime) / (1000 * 60 * 60 * 24));
                            const totalProfit = investment.investedAmount * (investment.dailyEarningRate * actualDurationDays);

                            // Validate profit calculation
                            if (totalProfit < 0 || !isFinite(totalProfit)) {
                                console.error('Invalid profit calculation:', { totalProfit, actualDurationDays, dailyEarningRate: investment.dailyEarningRate });
                                showNotification('Error calculating investment profit. Please contact support.', 'error');
                                return;
                            }

                            // Update user's balance in Firebase
                            await db.collection('users').doc(state.user.uid).update({
                                balance: firebase.firestore.FieldValue.increment(totalProfit)
                            });

                            // Update investment status in Firebase
                            await db.collection('investments').doc(investment.id).update({
                                status: 'Completed',
                                completedAt: firebase.firestore.FieldValue.serverTimestamp(),
                                actualDurationDays: actualDurationDays,
                                totalProfit: totalProfit
                            });

                            // Update local state
                            state.balance += totalProfit;
                            updateDashboard();

                            showNotification(`Investment in ${investment.planName} completed! Duration: ${actualDurationDays} days, Total profit: UGX ${totalProfit.toLocaleString()}`, 'success');
                        } catch (error) {
                            console.error('Error completing investment:', error);
                            showNotification('Error processing investment completion. Please contact support.', 'error');
                        }
                        return;
                    }

                    // Update countdown display
                    const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                    timerElement.textContent = `${days}d ${hours}h ${minutes}m ${seconds}s`;
                } catch (error) {
                    console.error('Error updating investment timer:', error);
                    // Clean up on error
                    clearInterval(timer.interval);
                    state.activeTimers.delete(investment.id);
                }
            };

            const timer = { interval: setInterval(updateTimer, 1000) };
            state.activeTimers.set(investment.id, timer);
            updateTimer();
        }

        // Function to clean up all active timers
        function cleanupAllTimers() {
            console.log('Cleaning up all active timers:', state.activeTimers.size);
            state.activeTimers.forEach((timer, investmentId) => {
                clearInterval(timer.interval);
            });
            state.activeTimers.clear();
        }

        // Function to get timer statistics
        function getTimerStats() {
            const activeCount = state.activeTimers.size;
            const investmentsWithTimers = Array.from(state.activeTimers.keys());

            console.log('Timer Statistics:', {
                activeTimers: activeCount,
                investmentIds: investmentsWithTimers,
                totalInvestments: state.investments.length
            });

            return {
                activeTimers: activeCount,
                investmentIds: investmentsWithTimers,
                totalInvestments: state.investments.length
            };
        }

        // Function to pause all timers
        function pauseAllTimers() {
            console.log('Pausing all timers');
            state.activeTimers.forEach((timer, investmentId) => {
                clearInterval(timer.interval);
                timer.isPaused = true;
            });
        }

        // Function to resume all timers
        function resumeAllTimers() {
            console.log('Resuming all timers');
            state.activeTimers.forEach((timer, investmentId) => {
                if (timer.isPaused) {
                    timer.interval = setInterval(() => {
                        // This would need to be implemented to call the original updateTimer function
                        console.log('Resuming timer for investment:', investmentId);
                    }, 1000);
                    timer.isPaused = false;
                }
            });
        }

        // Enhanced timer state management
        function manageTimerState(investmentId, action = 'get') {
            const timer = state.activeTimers.get(investmentId);

            switch (action) {
                case 'get':
                    return {
                        exists: !!timer,
                        isPaused: timer ? timer.isPaused : false,
                        investmentId: investmentId
                    };

                case 'pause':
                    if (timer && !timer.isPaused) {
                        clearInterval(timer.interval);
                        timer.isPaused = true;
                        console.log('Timer paused for investment:', investmentId);
                    }
                    break;

                case 'resume':
                    if (timer && timer.isPaused) {
                        // Resume logic would need the original updateTimer function
                        console.log('Timer resume requested for investment:', investmentId);
                    }
                    break;

                case 'stop':
                    if (timer) {
                        clearInterval(timer.interval);
                        state.activeTimers.delete(investmentId);
                        console.log('Timer stopped for investment:', investmentId);
                    }
                    break;

                default:
                    console.warn('Unknown timer action:', action);
            }
        }

        // Deposit Functions
        async function handleDepositSubmit(event) {
            event.preventDefault();
            const form = event.target;
            const method = form.dataset.method;

            let amount, transactionId, amountError, transactionIdError;

            if (method === 'Airtel') {
                amount = parseInt(document.getElementById('airtel-amount').value);
                transactionId = document.getElementById('airtel-transaction-id').value;
                amountError = document.getElementById('airtel-amount-error');
                transactionIdError = document.getElementById('airtel-transaction-id-error');
            } else if (method === 'MTN') {
                amount = parseInt(document.getElementById('mtn-amount').value);
                transactionId = document.getElementById('mtn-transaction-id').value;
                amountError = document.getElementById('mtn-amount-error');
                transactionIdError = document.getElementById('mtn-transaction-id-error');
            }

            // Clear previous errors
            if (amountError) amountError.textContent = '';
            if (transactionIdError) transactionIdError.textContent = '';

            const minDeposit = 10000;
            const maxDeposit = 3000000;

            let hasError = false;

            if (!amount || isNaN(amount)) {
                if (amountError) amountError.textContent = 'Please enter a valid amount.';
                hasError = true;
            } else if (amount < minDeposit || amount > maxDeposit) {
                if (amountError) amountError.textContent = `Amount must be between UGX ${minDeposit.toLocaleString()} and UGX ${maxDeposit.toLocaleString()}.`;
                hasError = true;
            }

            if (!transactionId || transactionId.trim() === '') {
                if (transactionIdError) transactionIdError.textContent = 'Transaction ID is required.';
                hasError = true;
            }

            if (hasError) return;

            // Disable submit button during processing
            const submitButton = form.querySelector('button[type="submit"]');
            if (submitButton) {
                submitButton.disabled = true;
                submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
            }

            try {
                const newDeposit = {
                    amount: amount,
                    method: method,
                    transactionId: transactionId,
                    status: 'pending',
                    userEmail: state.user ? state.user.email : '',
                    userId: state.user ? state.user.uid : '',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                };

                // Save to Firebase
                let depositRef;
                try {
                    depositRef = await db.collection('deposits').add(newDeposit);
                    console.log('Deposit saved to Firebase:', depositRef.id);
                } catch (firebaseError) {
                    console.error('Error saving deposit to Firebase:', firebaseError);
                    if (firebaseError.code === 'permission-denied') {
                        showNotification('Permission denied. Please check your account permissions.', 'error');
                    } else if (firebaseError.code === 'unavailable') {
                        showNotification('Service temporarily unavailable. Please try again later.', 'error');
                    } else {
                        showNotification('Error saving deposit. Please try again.', 'error');
                    }
                    return;
                }

                // Update local state only after successful Firebase save
                const localDeposit = {
                    id: depositRef.id,
                    date: new Date().toLocaleDateString(),
                    ...newDeposit
                };
                state.depositHistory.push(localDeposit);

                // Update deposit history immediately
                renderDepositHistory();

                showNotification(`Deposit of UGX ${amount.toLocaleString()} via ${method} is pending admin approval.`, 'success');
                form.reset();

            } catch (error) {
                console.error('Error submitting deposit:', error);
                let errorMessage = 'Error submitting deposit. Please try again.';

                if (error.code === 'permission-denied') {
                    errorMessage = 'Permission denied. Please check your account and try again.';
                } else if (error.code === 'unavailable') {
                    errorMessage = 'Service temporarily unavailable. Please try again later.';
                } else if (error.code === 'deadline-exceeded') {
                    errorMessage = 'Request timeout. Please check your connection and try again.';
                }

                showNotification(errorMessage, 'error');
            } finally {
                // Re-enable button
                if (submitButton) {
                    submitButton.disabled = false;
                    submitButton.innerHTML = 'Confirm Deposit';
                }
            }
        }

        function renderDepositHistory() {
            const tbody = document.getElementById('deposit-history-body');
            if (!tbody) return;

            tbody.innerHTML = '';

            if (state.depositHistory.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4">No deposit history.</td></tr>';
                return;
            }

            // Sort by date (newest first) and show all deposits including pending
            const sortedDeposits = state.depositHistory.sort((a, b) => new Date(b.date) - new Date(a.date));

            sortedDeposits.forEach(dep => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${dep.date}</td>
                    <td>UGX ${dep.amount.toLocaleString()}</td>
                    <td>${dep.method}</td>
                    <td><span class="status ${dep.status.toLowerCase().replace(/ /g, '-')}">${dep.status}</span></td>
                `;
            });
        }

        // Withdrawal Functions
        async function handleWithdrawalSubmit(event) {
            event.preventDefault();

            const amount = parseInt(document.getElementById('withdraw-amount').value);
            const method = document.getElementById('withdraw-method').value;
            const mobileNumber = document.getElementById('withdraw-number').value;
            const minWithdraw = 7000;

            // Clear previous errors
            document.querySelectorAll('#withdrawal-form .error-message').forEach(el => el.textContent = '');

            let hasError = false;

            if (!amount || isNaN(amount)) {
                document.getElementById('withdraw-amount-error').textContent = 'Please enter a valid amount.';
                hasError = true;
            } else if (amount < minWithdraw) {
                document.getElementById('withdraw-amount-error').textContent = `Minimum withdrawal amount is UGX ${minWithdraw.toLocaleString()}.`;
                hasError = true;
            }

            if (!method) {
                document.getElementById('withdraw-method-error').textContent = 'Please select a withdrawal method.';
                hasError = true;
            }

            if (!mobileNumber || mobileNumber.trim() === '') {
                document.getElementById('withdraw-number-error').textContent = 'Mobile money number is required.';
                hasError = true;
            } else if (!/^\+256[0-9]{9}$/.test(mobileNumber.trim())) {
                document.getElementById('withdraw-number-error').textContent = 'Please enter a valid Ugandan phone number (+256XXXXXXXXX).';
                hasError = true;
            }

            if (hasError) return;

            // Check balance and ensure minimum balance of 0 UGX
            if (amount > state.balance) {
                document.getElementById('withdraw-amount-error').textContent = 'Insufficient account balance for this withdrawal.';
                showNotification('Insufficient account balance for this withdrawal.', 'error');
                return;
            }

            // Validate balance operation
            if (!validateBalanceOperation(state.balance, amount, 'deduct')) {
                document.getElementById('withdraw-amount-error').textContent = 'Withdrawal amount cannot exceed your current balance.';
                return;
            }

            // Disable submit button during processing
            const submitButton = event.target.querySelector('button[type="submit"]');
            if (submitButton) {
                submitButton.disabled = true;
                submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
            }

            try {
                let remainingAmount = amount;
                let usedWelcomeBonus = 0;

                if (state.welcomeBonusAmount > 0) {
                    if (remainingAmount <= state.welcomeBonusAmount) {
                        usedWelcomeBonus = remainingAmount;
                        state.welcomeBonusAmount -= remainingAmount;
                        remainingAmount = 0;
                    } else {
                        usedWelcomeBonus = state.welcomeBonusAmount;
                        remainingAmount -= state.welcomeBonusAmount;
                        state.welcomeBonusAmount = 0;
                    }
                }

                // Update balance in Firebase if using real balance
                if (remainingAmount > 0) {
                    try {
                        await db.collection('users').doc(state.user.uid).update({
                            balance: firebase.firestore.FieldValue.increment(-remainingAmount)
                        });
                        console.log('User balance updated in Firebase for withdrawal');
                        state.balance -= remainingAmount;
                    } catch (balanceError) {
                        console.error('Error updating balance for withdrawal:', balanceError);
                        if (balanceError.code === 'permission-denied') {
                            showNotification('Permission denied to update balance. Please contact support.', 'error');
                        } else {
                            showNotification('Error updating account balance. Please try again.', 'error');
                        }
                        return;
                    }
                }

                const newWithdrawal = {
                    amount: amount,
                    method: method,
                    mobileNumber: mobileNumber.trim(),
                    usedWelcomeBonus: usedWelcomeBonus,
                    status: 'pending',
                    userEmail: state.user ? state.user.email : '',
                    userId: state.user ? state.user.uid : '',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                };

                // Save to Firebase
                let withdrawalRef;
                try {
                    withdrawalRef = await db.collection('withdrawals').add(newWithdrawal);
                    console.log('Withdrawal saved to Firebase:', withdrawalRef.id);
                } catch (firebaseError) {
                    console.error('Error saving withdrawal to Firebase:', firebaseError);
                    // Rollback balance change if Firebase save failed
                    if (remainingAmount > 0) {
                        try {
                            await db.collection('users').doc(state.user.uid).update({
                                balance: firebase.firestore.FieldValue.increment(remainingAmount)
                            });
                            state.balance += remainingAmount;
                            console.log('Balance rolled back due to withdrawal save failure');
                        } catch (rollbackError) {
                            console.error('Error rolling back balance:', rollbackError);
                        }
                    }

                    if (firebaseError.code === 'permission-denied') {
                        showNotification('Permission denied. Please check your account permissions.', 'error');
                    } else if (firebaseError.code === 'unavailable') {
                        showNotification('Service temporarily unavailable. Please try again later.', 'error');
                    } else {
                        showNotification('Error saving withdrawal. Please try again.', 'error');
                    }
                    return;
                }

                // Update local state only after successful Firebase operations
                const localWithdrawal = {
                    id: withdrawalRef.id,
                    date: new Date().toLocaleDateString(),
                    ...newWithdrawal
                };
                state.withdrawHistory.push(localWithdrawal);

                // Update both withdrawal history and dashboard immediately
                renderWithdrawalHistory();
                updateDashboard();

                showNotification(`Withdrawal of UGX ${amount.toLocaleString()} is pending admin approval.${usedWelcomeBonus > 0 ? ` (UGX ${usedWelcomeBonus.toLocaleString()} from welcome bonus)` : ''}`, 'success');
                event.target.reset();

            } catch (error) {
                console.error('Error submitting withdrawal:', error);
                let errorMessage = 'Error submitting withdrawal. Please try again.';

                if (error.code === 'permission-denied') {
                    errorMessage = 'Permission denied. Please check your account and try again.';
                } else if (error.code === 'unavailable') {
                    errorMessage = 'Service temporarily unavailable. Please try again later.';
                } else if (error.code === 'deadline-exceeded') {
                    errorMessage = 'Request timeout. Please check your connection and try again.';
                }

                showNotification(errorMessage, 'error');
            } finally {
                // Re-enable button
                if (submitButton) {
                    submitButton.disabled = false;
                    submitButton.innerHTML = 'Request Withdrawal';
                }
            }
        }

        function renderWithdrawalHistory() {
            const tbody = document.getElementById('withdraw-history-body');
            if (!tbody) return;

            tbody.innerHTML = '';

            if (state.withdrawHistory.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4">No withdrawal history.</td></tr>';
                return;
            }

            // Sort by date (newest first) and show all withdrawals including pending
            const sortedWithdrawals = state.withdrawHistory.sort((a, b) => new Date(b.date) - new Date(a.date));

            sortedWithdrawals.forEach(wd => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${wd.date}</td>
                    <td>UGX ${wd.amount.toLocaleString()}</td>
                    <td>${wd.method}</td>
                    <td><span class="status ${wd.status.toLowerCase().replace(/ /g, '-')}">${wd.status}</span></td>
                `;
            });
        }

        // Referral Functions
        function copyReferralLink() {
            const referralLink = document.getElementById('referral-link-display')?.href;
            if (referralLink) {
                navigator.clipboard.writeText(referralLink).then(() => {
                    showNotification('Referral link copied to clipboard!', 'success');
                }).catch(err => {
                    console.error('Failed to copy text: ', err);
                    showNotification('Failed to copy referral link.', 'error');
                });
            }
        }

        function renderMyReferrals(referrals = null) {
            const tbody = document.getElementById('my-referrals-table-body');
            if (!tbody) return;

            tbody.innerHTML = '';

            let referralsToShow = referrals;

            // If no referrals passed, try to load from state
            if (!referralsToShow && state.user) {
                // Load referrals from Firebase
                loadUserReferrals();
                return;
            }

            // Fallback to dummy data if no real data
            if (!referralsToShow) {
                const tbody = document.getElementById('my-referrals-table-body');
                tbody.innerHTML = '<tr><td colspan="4">Loading referrals...</td></tr>';
                return;
            }

            if (referralsToShow.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4">No referrals yet.</td></tr>';
                return;
            }

            referralsToShow.forEach(ref => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${ref.referredUserEmail || ref.user || 'N/A'}</td>
                    <td>${ref.dateJoined || (ref.createdAt ? new Date(ref.createdAt.toDate()).toLocaleDateString() : 'N/A')}</td>
                    <td>UGX ${(ref.totalInvestment || 0).toLocaleString()}</td>
                    <td>UGX ${(ref.earnedBonus || 0).toLocaleString()}</td>
                `;
            });
        }

        // Admin Functions
        function showAdminTab(tabId) {
            if (state.user?.email !== 'kaigwaakram123@gmail.com') {
                showNotification('Access denied. Admin privileges required.', 'error');
                return;
            }
            
            // Hide all admin tab contents
            document.querySelectorAll('.admin-tab-content').forEach(tab => {
                tab.style.display = 'none';
            });
            
            // Show the target tab content
            const targetTab = document.getElementById(`${tabId}-tab`);
            if (targetTab) {
                targetTab.style.display = 'block';
            }
            
            // Load data based on the selected tab
            if (tabId === 'pending-deposits') {
                loadPendingDeposits();
            } else if (tabId === 'pending-withdrawals') {
                loadPendingWithdrawals();
            }
        }

        async function loadPendingDeposits() {
            const tbody = document.getElementById('pending-deposits-body');
            tbody.innerHTML = '<tr><td colspan="6">Loading pending deposits...</td></tr>';

            try {
                console.log('Loading pending deposits from Firebase...');

                // First, let's check all deposits to see what's in the collection
                const allDepositsSnapshot = await db.collection('deposits').get();
                console.log('Total deposits in collection:', allDepositsSnapshot.size);

                allDepositsSnapshot.forEach(doc => {
                    console.log('Deposit:', doc.id, doc.data());
                });

                // Now query for pending deposits specifically
                const depositsSnapshot = await db.collection('deposits')
                    .where('status', '==', 'pending')
                    .get();

                const deposits = [];
                depositsSnapshot.forEach(doc => {
                    console.log('Found pending deposit:', doc.id, doc.data());
                    deposits.push({ id: doc.id, ...doc.data() });
                });

                console.log('Total pending deposits found:', deposits.length);

                if (deposits.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6">No pending deposits</td></tr>';
                    return;
                }

                tbody.innerHTML = deposits.map(deposit => `
                    <tr>
                        <td>${deposit.userEmail || 'N/A'}</td>
                        <td>UGX ${deposit.amount.toLocaleString()}</td>
                        <td>${deposit.method}</td>
                        <td>${deposit.transactionId}</td>
                        <td>${deposit.createdAt ? new Date(deposit.createdAt.toDate()).toLocaleDateString() : 'N/A'}</td>
                        <td>
                            <button onclick="approveDepositById('${deposit.id}')" class="btn btn-success">Approve</button>
                            <button onclick="rejectDepositById('${deposit.id}')" class="btn btn-danger">Reject</button>
                        </td>
                    </tr>
                `).join('');
                console.log('Pending deposits loaded successfully');

            } catch (error) {
                console.error('Error loading deposits:', error);
                tbody.innerHTML = '<tr><td colspan="6">Error loading deposits. Please try again.</td></tr>';
            }
        }

        async function loadPendingWithdrawals() {
            const tbody = document.getElementById('pending-withdrawals-body');
            tbody.innerHTML = '<tr><td colspan="6">Loading pending withdrawals...</td></tr>';

            try {
                console.log('Loading pending withdrawals from Firebase...');

                // First, let's check all withdrawals to see what's in the collection
                const allWithdrawalsSnapshot = await db.collection('withdrawals').get();
                console.log('Total withdrawals in collection:', allWithdrawalsSnapshot.size);

                allWithdrawalsSnapshot.forEach(doc => {
                    console.log('Withdrawal:', doc.id, doc.data());
                });

                // Now query for pending withdrawals specifically
                const withdrawalsSnapshot = await db.collection('withdrawals')
                    .where('status', '==', 'pending')
                    .get();

                const withdrawals = [];
                withdrawalsSnapshot.forEach(doc => {
                    console.log('Found pending withdrawal:', doc.id, doc.data());
                    withdrawals.push({ id: doc.id, ...doc.data() });
                });

                console.log('Total pending withdrawals found:', withdrawals.length);

                if (withdrawals.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6">No pending withdrawals</td></tr>';
                    return;
                }

                tbody.innerHTML = withdrawals.map(withdrawal => `
                    <tr>
                        <td>${withdrawal.userEmail || 'N/A'}</td>
                        <td>UGX ${withdrawal.amount.toLocaleString()}</td>
                        <td>${withdrawal.method}</td>
                        <td>${withdrawal.mobileNumber || 'N/A'}</td>
                        <td>${withdrawal.createdAt ? new Date(withdrawal.createdAt.toDate()).toLocaleDateString() : 'N/A'}</td>
                        <td>
                            <button onclick="approveWithdrawalById('${withdrawal.id}')" class="btn btn-success">Approve</button>
                            <button onclick="rejectWithdrawalById('${withdrawal.id}')" class="btn btn-danger">Reject</button>
                        </td>
                    </tr>
                `).join('');
                console.log('Pending withdrawals loaded successfully');

            } catch (error) {
                console.error('Error loading withdrawals:', error);
                tbody.innerHTML = '<tr><td colspan="6">Error loading withdrawals. Please try again.</td></tr>';
            }
        }


        function approveLocalDeposit(depositId) {
            const deposit = state.depositHistory.find(dep => dep.id === depositId);
            if (deposit) {
                deposit.status = 'Approved';
                state.balance += deposit.amount;
                updateDashboard();
                renderDepositHistory();
                loadPendingDeposits(); // Refresh the admin view
                showNotification('✅ Deposit approved and user balance updated automatically!', 'success');
            }
        }

        function rejectLocalDeposit(depositId) {
            const depositIndex = state.depositHistory.findIndex(dep => dep.id === depositId);
            if (depositIndex !== -1) {
                state.depositHistory[depositIndex].status = 'Rejected';
                renderDepositHistory();
                loadPendingDeposits(); // Refresh the admin view
                showNotification('Deposit rejected!', 'success');
            }
        }

        async function approveDepositById(depositId) {
            try {
                console.log('Approving deposit:', depositId);

                // Update in Firebase directly using the document ID
                const depositRef = db.collection('deposits').doc(depositId);
                const depositDoc = await depositRef.get();

                if (!depositDoc.exists) {
                    console.error('Deposit document not found:', depositId);
                    showNotification('Deposit not found!', 'error');
                    return;
                }

                const deposit = depositDoc.data();
                console.log('Deposit data:', deposit);

                // Update deposit status first
                await depositRef.update({
                    status: 'approved',
                    approvedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                console.log('Deposit status updated to approved');

                // Update user's balance in Firebase
                if (deposit.userEmail) {
                    try {
                        const userQuery = await db.collection('users').where('email', '==', deposit.userEmail).get();
                        if (!userQuery.empty) {
                            const userDoc = userQuery.docs[0];
                            const currentBalance = userDoc.data().balance || 0;
                            const newBalance = currentBalance + deposit.amount;

                            // Validate that new balance won't be negative
                            if (newBalance < 0) {
                                showNotification('Cannot approve deposit: would result in negative balance.', 'error');
                                return;
                            }

                            await userDoc.ref.update({
                                balance: firebase.firestore.FieldValue.increment(deposit.amount)
                            });
                            console.log('User balance updated successfully');
                        } else {
                            console.error('User not found for email:', deposit.userEmail);
                            showNotification('User not found. Cannot update balance.', 'error');
                            return;
                        }
                    } catch (balanceError) {
                        console.error('Error updating user balance:', balanceError);
                        showNotification(`Error updating user balance: ${balanceError.message}`, 'error');
                        return;
                    }
                }

                // Update local state if this deposit belongs to current user
                const localDepositIndex = state.depositHistory.findIndex(dep => dep.id === depositId);
                if (localDepositIndex !== -1) {
                    state.depositHistory[localDepositIndex].status = 'Approved';
                    renderDepositHistory();
                }

                loadPendingDeposits(); // Refresh the admin view
                showNotification('Deposit approved successfully!', 'success');

            } catch (error) {
                console.error('Error approving deposit:', error);
                showNotification(`Error approving deposit: ${error.message}`, 'error');
            }
        }

        async function rejectDepositById(depositId) {
            try {
                console.log('Rejecting deposit:', depositId);

                // Update in Firebase directly using the document ID
                const depositRef = db.collection('deposits').doc(depositId);
                const depositDoc = await depositRef.get();

                if (!depositDoc.exists) {
                    console.error('Deposit document not found:', depositId);
                    showNotification('Deposit not found!', 'error');
                    return;
                }

                // Update deposit status
                await depositRef.update({
                    status: 'rejected',
                    rejectedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                console.log('Deposit status updated to rejected');

                // Update local state if this deposit belongs to current user
                const localDepositIndex = state.depositHistory.findIndex(dep => dep.id === depositId);
                if (localDepositIndex !== -1) {
                    state.depositHistory[localDepositIndex].status = 'Rejected';
                    renderDepositHistory();
                }

                loadPendingDeposits(); // Refresh the admin view
                showNotification('Deposit rejected!', 'success');

            } catch (error) {
                console.error('Error rejecting deposit:', error);
                showNotification(`Error rejecting deposit: ${error.message}`, 'error');
            }
        }

        function approveLocalWithdrawal(withdrawalId) {
            const withdrawal = state.withdrawHistory.find(wd => wd.id === withdrawalId);
            if (withdrawal) {
                withdrawal.status = 'Approved';
                updateDashboard();
                renderWithdrawalHistory();
                loadPendingWithdrawals(); // Refresh the admin view
                showNotification('Withdrawal approved successfully!', 'success');
            }
        }

        function rejectLocalWithdrawal(withdrawalId) {
            const withdrawalIndex = state.withdrawHistory.findIndex(wd => wd.id === withdrawalId);
            if (withdrawalIndex !== -1) {
                state.withdrawHistory[withdrawalIndex].status = 'Rejected';
                // Return the money back to the user's balance
                state.balance += state.withdrawHistory[withdrawalIndex].amount;
                updateDashboard();
                renderWithdrawalHistory();
                loadPendingWithdrawals(); // Refresh the admin view
                showNotification('✅ Withdrawal rejected and funds returned to user automatically!', 'success');
            }
        }

        async function approveWithdrawalById(withdrawalId) {
            try {
                console.log('Approving withdrawal:', withdrawalId);

                // Update in Firebase directly using the document ID
                const withdrawalRef = db.collection('withdrawals').doc(withdrawalId);
                const withdrawalDoc = await withdrawalRef.get();

                if (!withdrawalDoc.exists) {
                    console.error('Withdrawal document not found:', withdrawalId);
                    showNotification('Withdrawal not found!', 'error');
                    return;
                }

                const withdrawal = withdrawalDoc.data();
                console.log('Withdrawal data:', withdrawal);

                // Update withdrawal status
                await withdrawalRef.update({
                    status: 'approved',
                    approvedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                console.log('Withdrawal status updated to approved');

                // Note: For withdrawal approval, we don't need to update user balance
                // as the money was already deducted when the withdrawal was requested

                // Update local state if this withdrawal belongs to current user
                const localWithdrawalIndex = state.withdrawHistory.findIndex(wd => wd.id === withdrawalId);
                if (localWithdrawalIndex !== -1) {
                    state.withdrawHistory[localWithdrawalIndex].status = 'Approved';
                    renderWithdrawalHistory();
                }

                loadPendingWithdrawals(); // Refresh the admin view
                showNotification('Withdrawal approved successfully!', 'success');

            } catch (error) {
                console.error('Error approving withdrawal:', error);
                showNotification(`Error approving withdrawal: ${error.message}`, 'error');
            }
        }

        async function rejectWithdrawalById(withdrawalId) {
            try {
                console.log('Rejecting withdrawal:', withdrawalId);

                // Update in Firebase directly using the document ID
                const withdrawalRef = db.collection('withdrawals').doc(withdrawalId);
                const withdrawalDoc = await withdrawalRef.get();

                if (!withdrawalDoc.exists) {
                    console.error('Withdrawal document not found:', withdrawalId);
                    showNotification('Withdrawal not found!', 'error');
                    return;
                }

                const withdrawal = withdrawalDoc.data();
                console.log('Withdrawal data:', withdrawal);

                // Update withdrawal status first
                await withdrawalRef.update({
                    status: 'rejected',
                    rejectedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                console.log('Withdrawal status updated to rejected');

                // Return the money to user's balance in Firebase
                if (withdrawal.userEmail) {
                    try {
                        const userQuery = await db.collection('users').where('email', '==', withdrawal.userEmail).get();
                        if (!userQuery.empty) {
                            const userDoc = userQuery.docs[0];
                            const currentBalance = userDoc.data().balance || 0;
                            const newBalance = currentBalance + withdrawal.amount;

                            // Validate that new balance won't be negative (shouldn't happen when returning money, but safety check)
                            if (newBalance < 0) {
                                showNotification('Cannot return funds: would result in negative balance.', 'error');
                                return;
                            }

                            await userDoc.ref.update({
                                balance: firebase.firestore.FieldValue.increment(withdrawal.amount)
                            });
                            console.log('User balance updated successfully (money returned)');
                        } else {
                            console.error('User not found for email:', withdrawal.userEmail);
                            showNotification('User not found. Cannot return funds.', 'error');
                            return;
                        }
                    } catch (balanceError) {
                        console.error('Error updating user balance:', balanceError);
                        showNotification(`Error returning funds: ${balanceError.message}`, 'error');
                        return;
                    }
                }

                // Update local state if this withdrawal belongs to current user
                const localWithdrawalIndex = state.withdrawHistory.findIndex(wd => wd.id === withdrawalId);
                if (localWithdrawalIndex !== -1) {
                    state.withdrawHistory[localWithdrawalIndex].status = 'Rejected';
                    // Return the money back to the user's balance
                    state.balance += state.withdrawHistory[localWithdrawalIndex].amount;
                    updateDashboard();
                    renderWithdrawalHistory();
                }

                loadPendingWithdrawals(); // Refresh the admin view
                showNotification('Withdrawal rejected! Funds returned to user.', 'success');

            } catch (error) {
                console.error('Error rejecting withdrawal:', error);
                showNotification(`Error rejecting withdrawal: ${error.message}`, 'error');
            }
        }

        function approveDeposit(depositId) {
            db.collection('deposits').doc(depositId).get()
                .then((depositDoc) => {
                    const deposit = depositDoc.data();
                    
                    return db.collection('deposits').doc(depositId).update({
                        status: 'approved',
                        approvedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                })
                .then(() => {
                    return db.collection('users').where('email', '==', deposit.userEmail).get();
                })
                .then((userDoc) => {
                    if (!userDoc.empty) {
                        const userRef = userDoc.docs[0].ref;
                        return userRef.update({
                            balance: firebase.firestore.FieldValue.increment(deposit.amount)
                        });
                    }
                })
                .then(() => {
                    showNotification('Deposit approved successfully!', 'success');
                    loadPendingDeposits();
                })
                .catch((error) => {
                    console.error('Error approving deposit:', error);
                    showNotification('Error approving deposit: ' + error.message, 'error');
                });
        }

        function rejectDeposit(depositId) {
            db.collection('deposits').doc(depositId).update({
                status: 'rejected',
                rejectedAt: firebase.firestore.FieldValue.serverTimestamp()
            })
                .then(() => {
                    showNotification('Deposit rejected!', 'success');
                    loadPendingDeposits();
                })
                .catch((error) => {
                    console.error('Error rejecting deposit:', error);
                    showNotification('Error rejecting deposit: ' + error.message, 'error');
                });
        }

        function approveWithdrawal(withdrawalId) {
            db.collection('withdrawals').doc(withdrawalId).get()
                .then((withdrawalDoc) => {
                    const withdrawal = withdrawalDoc.data();
                    
                    return db.collection('withdrawals').doc(withdrawalId).update({
                        status: 'approved',
                        approvedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                })
                .then(() => {
                    return db.collection('users').where('email', '==', withdrawal.userEmail).get();
                })
                .then((userDoc) => {
                    if (!userDoc.empty) {
                        const userRef = userDoc.docs[0].ref;
                        return userRef.update({
                            balance: firebase.firestore.FieldValue.increment(-withdrawal.amount)
                        });
                    }
                })
                .then(() => {
                    showNotification('Withdrawal approved successfully!', 'success');
                    loadPendingWithdrawals();
                })
                .catch((error) => {
                    console.error('Error approving withdrawal:', error);
                    showNotification('Error approving withdrawal: ' + error.message, 'error');
                });
        }

        function rejectWithdrawal(withdrawalId) {
            db.collection('withdrawals').doc(withdrawalId).update({
                status: 'rejected',
                rejectedAt: firebase.firestore.FieldValue.serverTimestamp()
            })
                .then(() => {
                    showNotification('Withdrawal rejected!', 'success');
                    loadPendingWithdrawals();
                })
                .catch((error) => {
                    console.error('Error rejecting withdrawal:', error);
                    showNotification('Error rejecting withdrawal: ' + error.message, 'error');
                });
        }

        // Dashboard Functions
        function showDashboardTab(tabId) {
            if (!state.isLoggedIn) {
                showNotification('Please login to access the dashboard.', 'error');
                showPage('login-page');
                return;
            }

            // Check admin access for admin tab
            if (tabId === 'admin-tab') {
                if (state.user?.email !== 'kaigwaakram123@gmail.com') {
                    showNotification('Access denied. Admin privileges required.', 'error');
                    return;
                }
            }

            // Hide all tab contents
            document.querySelectorAll('.dashboard-tab-content').forEach(content => {
                content.classList.remove('active');
                content.style.display = 'none';
            });

            // Show target tab content
            const targetTab = document.getElementById(tabId);
            if (targetTab) {
                targetTab.classList.add('active');
                targetTab.style.display = 'block';
            }

            // Update navigation active state
            document.querySelectorAll('.dashboard-nav .nav-item').forEach(navItem => {
                navItem.classList.remove('active');
            });

            const activeNavItem = document.querySelector(`.dashboard-nav .nav-item[data-target="${tabId}"]`);
            if (activeNavItem) {
                activeNavItem.classList.add('active');
            }

            // Update dashboard data
            updateDashboard();

            // Load tab-specific content
            if (tabId === 'my-investments-tab') {
                loadUserInvestments();
                updateInvestmentOverview();
            } else if (tabId !== 'my-investments-tab') {
                // Clean up timers when leaving investments tab
                cleanupAllTimers();
            }

            if (tabId === 'deposit-tab') {
                loadUserDeposits();
            } else if (tabId === 'withdraw-tab') {
                loadUserWithdrawals();
            } else if (tabId === 'referrals-tab') {
                loadUserReferrals();
            }
        }

        function updateDashboard() {
            const welcomeMessage = document.getElementById('welcome-message');
            if (welcomeMessage && state.user) {
                welcomeMessage.textContent = `Welcome, ${state.user.username}!`;
            }
            
            const displayUsername = document.getElementById('display-username');
            const displayEmail = document.getElementById('display-email');
            const displayPhone = document.getElementById('display-phone');
            const displayAccountBalance = document.getElementById('display-account-balance-account');
            const accountBalance = document.getElementById('account-balance');
            
            if (displayUsername && state.user) {
                displayUsername.textContent = state.user.username;
            }
            
            if (displayEmail && state.user) {
                displayEmail.textContent = state.user.email || 'N/A';
            }
            
            if (displayPhone && state.user) {
                displayPhone.textContent = state.user.phone || 'N/A';
            }
            
            const totalBalance = state.balance;
            const welcomeBonusText = state.welcomeBonusAmount > 0 ? ` (Bonus: UGX ${state.welcomeBonusAmount.toLocaleString()})` : '';
            
            if (displayAccountBalance) {
                displayAccountBalance.textContent = `UGX ${totalBalance.toLocaleString()}${welcomeBonusText}`;
            }
            
            if (accountBalance) {
                accountBalance.textContent = `Current Balance: UGX ${totalBalance.toLocaleString()}${welcomeBonusText}`;
            }
            
            


            // Update investment overview displays
            updateInvestmentOverview();
        }

        function updateInvestmentOverview() {
            // Update balance display in investments tab
            const investmentBalanceDisplay = document.getElementById('investment-balance-display');
            if (investmentBalanceDisplay) {
                investmentBalanceDisplay.textContent = state.balance.toLocaleString();
            }

            // Calculate total invested amount
            const totalInvested = state.investments.reduce((total, inv) => {
                return total + (inv.status === 'Active' || inv.status === 'Completed' ? inv.investedAmount : 0);
            }, 0);

            const totalInvestedDisplay = document.getElementById('total-invested-display');
            if (totalInvestedDisplay) {
                totalInvestedDisplay.textContent = totalInvested.toLocaleString();
            }

            // Count active investments
            const activeInvestments = state.investments.filter(inv =>
                inv.status === 'Active' || !inv.status
            ).length;

            const activeInvestmentsCount = document.getElementById('active-investments-count');
            if (activeInvestmentsCount) {
                activeInvestmentsCount.textContent = activeInvestments;
            }
        }

        // Form Handlers
        async function handleRegistration(event) {
            event.preventDefault();

            console.log('📝 Starting registration process...');

            const username = document.getElementById('reg-username').value.trim();
            const email = document.getElementById('reg-email').value.trim();
            const phone = document.getElementById('reg-phone').value.trim();
            const password = document.getElementById('reg-password').value;
            const confirmPassword = document.getElementById('reg-confirm-password').value;

            // Clear previous errors
            document.querySelectorAll('.error-message').forEach(el => el.textContent = '');

            let hasError = false;

            // Validate username
            if (!username) {
                document.getElementById('reg-username-error').textContent = 'Username is required';
                hasError = true;
            } else if (username.length < 3) {
                document.getElementById('reg-username-error').textContent = 'Username must be at least 3 characters long';
                hasError = true;
            } else if (!/^[a-zA-Z0-9_]+$/.test(username)) {
                document.getElementById('reg-username-error').textContent = 'Username can only contain letters, numbers, and underscores';
                hasError = true;
            }

            // Validate email
            if (!email) {
                document.getElementById('reg-email-error').textContent = 'Email is required';
                hasError = true;
            } else if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                document.getElementById('reg-email-error').textContent = 'Please enter a valid email address';
                hasError = true;
            }

            // Validate phone
            if (!phone) {
                document.getElementById('reg-phone-error').textContent = 'Phone number is required';
                hasError = true;
            } else if (!/^\+256[0-9]{9}$/.test(phone)) {
                document.getElementById('reg-phone-error').textContent = 'Please enter a valid phone number (+256XXXXXXXXX)';
                hasError = true;
            }

            // Validate password
            if (!password) {
                document.getElementById('reg-password-error').textContent = 'Password is required';
                hasError = true;
            } else if (password.length < 6) {
                document.getElementById('reg-password-error').textContent = 'Password must be at least 6 characters long';
                hasError = true;
            } else if (!/(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/.test(password)) {
                document.getElementById('reg-password-error').textContent = 'Password must contain at least one uppercase letter, one lowercase letter, and one number';
                hasError = true;
            }

            // Validate confirm password
            if (!confirmPassword) {
                document.getElementById('reg-confirm-password-error').textContent = 'Please confirm your password';
                hasError = true;
            } else if (password !== confirmPassword) {
                document.getElementById('reg-confirm-password-error').textContent = 'Passwords do not match';
                hasError = true;
            }

            if (hasError) return;

            // Disable submit button during processing
            const submitButton = event.target.querySelector('button[type="submit"]');
            if (submitButton) {
                submitButton.disabled = true;
                submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating Account...';
            }

            try {
                console.log('🔐 Creating user account...');
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                const user = userCredential.user;

                console.log('👤 Updating user profile...');
                await user.updateProfile({
                    displayName: username
                });

                console.log('💾 Saving user data to database...');
                await db.collection('users').doc(user.uid).set({
                    username: username,
                    email: email,
                    phone: phone,
                    balance: 4000, // Welcome bonus automatically added
                    welcomeBonusClaimed: true, // Mark as claimed since it's automatic
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    referralCode: username.toUpperCase() + '123',
                    authProvider: 'email'
                });

                // Update state
                state.user = {
                    uid: user.uid,
                    username: username,
                    email: email,
                    phone: phone
                };
                state.balance = 4000; // Welcome bonus automatically added
                state.welcomeBonusAmount = 0; // No need to claim since it's automatic
                state.isLoggedIn = true;

                const welcomeBonusSection = document.getElementById('welcome-bonus-section');
                if (welcomeBonusSection) {
                    welcomeBonusSection.style.display = 'block';
                }

                showNotification(`✅ Registration successful for ${username}! Please claim your welcome bonus.`, 'success');
                event.target.reset();

            } catch (error) {
                console.error('❌ Registration error:', error);
                let errorMessage = 'Registration failed. Please try again.';

                if (error.code === 'auth/email-already-in-use') {
                    errorMessage = 'An account with this email already exists. Please use a different email or try logging in.';
                    document.getElementById('reg-email-error').textContent = errorMessage;
                } else if (error.code === 'auth/weak-password') {
                    errorMessage = 'Password is too weak. Please choose a stronger password.';
                    document.getElementById('reg-password-error').textContent = errorMessage;
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = 'Invalid email address format.';
                    document.getElementById('reg-email-error').textContent = errorMessage;
                } else if (error.code === 'auth/operation-not-allowed') {
                    errorMessage = 'Email/password registration is not enabled. Please check Firebase Authentication settings.';
                }

                showNotification(errorMessage, 'error');
            } finally {
                // Re-enable submit button
                if (submitButton) {
                    submitButton.disabled = false;
                    submitButton.innerHTML = 'Sign Up';
                }
            }
        }

        function handleLogin(event) {
            event.preventDefault();

            const usernameOrEmail = document.getElementById('login-username-email').value.trim();
            const password = document.getElementById('login-password').value;

            // Clear previous errors
            document.querySelectorAll('.error-message').forEach(el => el.textContent = '');

            let hasError = false;

            if (!usernameOrEmail) {
                document.getElementById('login-username-email-error').textContent = 'Username or email is required';
                hasError = true;
            }

            if (!password) {
                document.getElementById('login-password-error').textContent = 'Password is required';
                hasError = true;
            }

            if (hasError) return;

            // Disable submit button during processing
            const submitButton = event.target.querySelector('button[type="submit"]');
            if (submitButton) {
                submitButton.disabled = true;
                submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Signing In...';
            }

            auth.signInWithEmailAndPassword(usernameOrEmail, password)
                .then((userCredential) => {
                    const user = userCredential.user;

                    return db.collection('users').doc(user.uid).get();
                })
                .then((userDoc) => {
                    if (userDoc.exists) {
                        const userData = userDoc.data();

                        // Update state first
                        state.user = {
                            uid: auth.currentUser.uid,
                            username: userData.username,
                            email: userData.email,
                            phone: userData.phone || ''
                        };

                        state.balance = userData.balance || 0;
                        state.welcomeBonusAmount = userData.welcomeBonusClaimed ? 0 : 4000;
                        state.isLoggedIn = true;

                        showNotification(`Welcome back, ${userData.username}!`, 'success');

                        // Use setTimeout to ensure state is updated before showing dashboard
                        setTimeout(() => {
                            showPage('dashboard-page');
                        }, 100);
                    } else {
                        throw new Error('User data not found. Please contact support.');
                    }
                })
                .catch((error) => {
                    console.error('Login error:', error);
                    let errorMessage = 'Login failed. Please check your credentials and try again.';

                    if (error.code === 'auth/user-not-found') {
                        errorMessage = 'No account found with this email/username. Please check or register.';
                    } else if (error.code === 'auth/wrong-password') {
                        errorMessage = 'Incorrect password. Please try again.';
                    } else if (error.code === 'auth/invalid-email') {
                        errorMessage = 'Invalid email format. Please check your email.';
                    } else if (error.code === 'auth/user-disabled') {
                        errorMessage = 'This account has been disabled. Please contact support.';
                    } else if (error.code === 'auth/too-many-requests') {
                        errorMessage = 'Too many failed attempts. Please wait a few minutes and try again.';
                    }

                    document.getElementById('login-username-email-error').textContent = errorMessage;
                    showNotification(errorMessage, 'error');
                })
                .finally(() => {
                    // Re-enable submit button
                    if (submitButton) {
                        submitButton.disabled = false;
                        submitButton.innerHTML = 'Login';
                    }
                });
        }

        function handleForgotPassword(event) {
            event.preventDefault();
            
            const email = document.getElementById('forgot-email').value;
            
            if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                document.getElementById('forgot-email-error').textContent = 'Please enter a valid email address';
                return;
            }
            
            auth.sendPasswordResetEmail(email)
                .then(() => {
                    showNotification(`Password reset link sent to ${email}.`, 'success');
                    showPage('login-page');
                })
                .catch((error) => {
                    console.error('Password reset error:', error);
                    showNotification(`Password reset error: ${error.message}`, 'error');
                });
        }


        // Enhanced user-specific data validation
        function validateUserAccess(data, userField = 'userId') {
            if (!state.user) {
                console.error('❌ No authenticated user for data validation');
                return false;
            }

            if (!data || !data[userField]) {
                console.error('❌ Invalid data structure for user validation:', data);
                return false;
            }

            const dataUserId = data[userField];
            const currentUserId = state.user.uid;

            if (dataUserId !== currentUserId) {
                console.warn('⚠️ Data access validation failed:', {
                    dataUserId: dataUserId,
                    currentUserId: currentUserId,
                    data: data
                });
                return false;
            }

            return true;
        }

        // Firebase Data Loading Functions
        async function loadUserData() {
            if (!state.user) return;

            try {
                const userDoc = await db.collection('users').doc(state.user.uid).get();
                if (userDoc.exists) {
                    const userData = userDoc.data();
                    state.balance = userData.balance || 0;
                    state.welcomeBonusAmount = userData.welcomeBonusClaimed ? 0 : 4000;
                    updateDashboard();
                }
            } catch (error) {
                console.error('Error loading user data:', error);
            }
        }

        async function loadUserInvestments() {
            if (!state.user) {
                console.error('❌ Cannot load investments: No authenticated user');
                return;
            }

            try {
                console.log('🔍 Loading investments for user:', state.user.uid);

                const investmentsSnapshot = await db.collection('investments')
                    .where('userId', '==', state.user.uid)
                    .get();

                console.log('📊 Found', investmentsSnapshot.size, 'investments for user');

                state.investments = [];
                investmentsSnapshot.forEach(doc => {
                    const investment = { id: doc.id, ...doc.data() };

                    // Enhanced validation: Double-check user access
                    if (!validateUserAccess(investment, 'userId')) {
                        console.warn('⚠️ Skipping investment due to user validation failure:', investment.id);
                        return;
                    }

                    // Convert Firestore timestamps to Date objects
                    if (investment.startDate && investment.startDate.toDate) {
                        investment.startDate = investment.startDate.toDate();
                    }
                    if (investment.endDate && investment.endDate.toDate) {
                        investment.endDate = investment.endDate.toDate();
                    }

                    console.log('✅ Valid investment loaded:', {
                        id: investment.id,
                        planName: investment.planName,
                        amount: investment.investedAmount,
                        status: investment.status
                    });

                    state.investments.push(investment);
                });

                console.log('📈 Total valid investments loaded:', state.investments.length);
                renderInvestments();

                // Show summary to user
                if (state.investments.length === 0) {
                    showNotification('No investments found for your account.', 'info');
                } else {
                    showNotification(`Loaded ${state.investments.length} investment(s) for your account.`, 'success');
                }

            } catch (error) {
                console.error('❌ Error loading investments:', error);

                // Provide specific error messages based on error type
                if (error.code === 'permission-denied') {
                    showNotification('Permission denied: Cannot access investments. Please check your account permissions.', 'error');
                } else if (error.code === 'unavailable') {
                    showNotification('Service temporarily unavailable. Please try again later.', 'error');
                } else {
                    showNotification('Error loading investments. Please refresh the page and try again.', 'error');
                }
            }
        }

        async function loadUserDeposits() {
            if (!state.user) return;

            try {
                const depositsSnapshot = await db.collection('deposits')
                    .where('userEmail', '==', state.user.email)
                    .get();

                state.depositHistory = [];
                depositsSnapshot.forEach(doc => {
                    const deposit = { id: doc.id, ...doc.data() };
                    // Convert Firestore timestamps to Date objects
                    if (deposit.createdAt && deposit.createdAt.toDate) {
                        deposit.date = deposit.createdAt.toDate().toLocaleDateString();
                    }
                    state.depositHistory.push(deposit);
                });

                renderDepositHistory();
            } catch (error) {
                console.error('Error loading deposits:', error);
            }
        }

        async function loadUserWithdrawals() {
            if (!state.user) return;

            try {
                const withdrawalsSnapshot = await db.collection('withdrawals')
                    .where('userEmail', '==', state.user.email)
                    .get();

                state.withdrawHistory = [];
                withdrawalsSnapshot.forEach(doc => {
                    const withdrawal = { id: doc.id, ...doc.data() };
                    // Convert Firestore timestamps to Date objects
                    if (withdrawal.createdAt && withdrawal.createdAt.toDate) {
                        withdrawal.date = withdrawal.createdAt.toDate().toLocaleDateString();
                    }
                    state.withdrawHistory.push(withdrawal);
                });

                renderWithdrawalHistory();
            } catch (error) {
                console.error('Error loading withdrawals:', error);
            }
        }

        async function loadUserReferrals() {
            if (!state.user) return;

            try {
                const referralsSnapshot = await db.collection('referrals')
                    .where('referrerId', '==', state.user.uid)
                    .get();

                const referrals = [];
                referralsSnapshot.forEach(doc => {
                    referrals.push({ id: doc.id, ...doc.data() });
                });

                renderMyReferrals(referrals);
            } catch (error) {
                console.error('Error loading referrals:', error);
            }
        }

        // Real-time listeners for Firebase data
        function setupRealtimeListeners() {
            if (!state.user) return;

            // Listen for user data changes
            db.collection('users').doc(state.user.uid)
                .onSnapshot((doc) => {
                    if (doc.exists) {
                        const userData = doc.data();
                        state.balance = userData.balance || 0;
                        state.welcomeBonusAmount = userData.welcomeBonusClaimed ? 0 : 4000;
                        updateDashboard();
                    }
                }, (error) => {
                    console.error('Error listening to user data:', error);
                });

            // Listen for investment changes
            db.collection('investments').where('userId', '==', state.user.uid)
                .onSnapshot((snapshot) => {
                    console.log('🔄 Real-time investment update received:', snapshot.size, 'documents');

                    state.investments = [];
                    let validCount = 0;

                    snapshot.forEach(doc => {
                        const investment = { id: doc.id, ...doc.data() };

                        // Enhanced validation for real-time updates
                        if (!validateUserAccess(investment, 'userId')) {
                            console.warn('⚠️ Real-time listener: Skipping investment due to user validation failure:', investment.id);
                            return;
                        }

                        // Convert Firestore timestamps to Date objects
                        if (investment.startDate && investment.startDate.toDate) {
                            investment.startDate = investment.startDate.toDate();
                        }
                        if (investment.endDate && investment.endDate.toDate) {
                            investment.endDate = investment.endDate.toDate();
                        }

                        console.log('✅ Real-time: Valid investment update:', {
                            id: investment.id,
                            planName: investment.planName,
                            status: investment.status
                        });

                        state.investments.push(investment);
                        validCount++;
                    });

                    console.log('📊 Real-time: Loaded', validCount, 'valid investments out of', snapshot.size, 'total');
                    renderInvestments();

                    // Show real-time update notification
                    if (validCount > 0) {
                        showNotification(`Investment data updated: ${validCount} investment(s) loaded.`, 'info');
                    }
                }, (error) => {
                    console.error('❌ Error listening to investments:', error);

                    if (error.code === 'permission-denied') {
                        showNotification('Permission denied for real-time investment updates. Please refresh the page.', 'error');
                    } else {
                        showNotification('Error receiving real-time investment updates. Some data may be outdated.', 'error');
                    }
                });

            // Listen for deposit changes
            db.collection('deposits').where('userEmail', '==', state.user.email)
                .onSnapshot((snapshot) => {
                    state.depositHistory = [];
                    snapshot.forEach(doc => {
                        const deposit = { id: doc.id, ...doc.data() };
                        // Convert Firestore timestamps to Date objects
                        if (deposit.createdAt && deposit.createdAt.toDate) {
                            deposit.date = deposit.createdAt.toDate().toLocaleDateString();
                        }
                        state.depositHistory.push(deposit);
                    });
                    renderDepositHistory();
                }, (error) => {
                    console.error('Error listening to deposits:', error);
                });

            // Listen for withdrawal changes
            db.collection('withdrawals').where('userEmail', '==', state.user.email)
                .onSnapshot((snapshot) => {
                    state.withdrawHistory = [];
                    snapshot.forEach(doc => {
                        const withdrawal = { id: doc.id, ...doc.data() };
                        // Convert Firestore timestamps to Date objects
                        if (withdrawal.createdAt && withdrawal.createdAt.toDate) {
                            withdrawal.date = withdrawal.createdAt.toDate().toLocaleDateString();
                        }
                        state.withdrawHistory.push(withdrawal);
                    });
                    renderWithdrawalHistory();
                }, (error) => {
                    console.error('Error listening to withdrawals:', error);
                });
        }

        // Test function for debugging (can be called from browser console)
        window.testAdminFunctions = async function() {
            console.log('Testing admin functions...');

            try {
                // Test loading pending deposits
                console.log('Testing loadPendingDeposits...');
                await loadPendingDeposits();

                // Test loading pending withdrawals
                console.log('Testing loadPendingWithdrawals...');
                await loadPendingWithdrawals();

                console.log('Admin functions test completed');
            } catch (error) {
                console.error('Error testing admin functions:', error);
            }
        };

        // Test Firebase permissions
        window.testFirebasePermissions = async function() {
            console.log('🔧 Testing Firebase permissions...');
            console.log('Current user:', auth.currentUser?.email);

            try {
                // Test if we can read from deposits collection
                console.log('📖 Testing deposits collection read access...');
                const testDeposits = await db.collection('deposits').limit(1).get();
                console.log('Deposits read access:', testDeposits.size > 0 ? '✅ SUCCESS' : '❌ NO DATA');

                // Test if we can read from withdrawals collection
                console.log('📖 Testing withdrawals collection read access...');
                const testWithdrawals = await db.collection('withdrawals').limit(1).get();
                console.log('Withdrawals read access:', testWithdrawals.size > 0 ? '✅ SUCCESS' : '❌ NO DATA');

                // Test if we can read from users collection
                console.log('📖 Testing users collection read access...');
                const testUsers = await db.collection('users').limit(1).get();
                console.log('Users read access:', testUsers.size > 0 ? '✅ SUCCESS' : '❌ NO DATA');

                // Test if we can write to deposits collection
                console.log('✏️ Testing deposits collection write access...');
                try {
                    const testDoc = await db.collection('deposits').add({
                        test: true,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    console.log('✅ Deposits write access: SUCCESS');

                    // Clean up test document
                    await testDoc.delete();
                    console.log('🗑️ Test document cleaned up');
                } catch (writeError) {
                    console.error('❌ Deposits write access failed:', writeError.message);
                    console.error('Error code:', writeError.code);
                }

                // Test user balance update specifically
                console.log('💰 Testing user balance update...');
                try {
                    const currentUser = auth.currentUser;
                    if (currentUser) {
                        await db.collection('users').doc(currentUser.uid).update({
                            balance: firebase.firestore.FieldValue.increment(0) // Test update
                        });
                        console.log('✅ User balance update access: SUCCESS');
                    } else {
                        console.log('❌ No authenticated user for balance test');
                    }
                } catch (balanceError) {
                    console.error('❌ User balance update failed:', balanceError.message);
                    console.error('Error code:', balanceError.code);
                }

                console.log('🔧 Firebase permissions test completed');
            } catch (error) {
                console.error('❌ Error testing Firebase permissions:', error);
            }
        };

        // Force refresh admin data
        window.forceRefreshAdminData = async function() {
            console.log('🔄 Force refreshing admin data...');
            try {
                await loadPendingDeposits();
                await loadPendingWithdrawals();
                console.log('✅ Admin data refreshed successfully');
            } catch (error) {
                console.error('❌ Error refreshing admin data:', error);
            }
        };

        // Test balance functionality
        window.testBalanceFunctionality = function() {
            console.log('🧪 Testing balance functionality...');

            // Test balance validation utility
            console.log('Testing balance validation utility...');
            console.log('validateBalanceOperation(1000, 500, "deduct"):', validateBalanceOperation(1000, 500, 'deduct')); // Should be true
            console.log('validateBalanceOperation(500, 1000, "deduct"):', validateBalanceOperation(500, 1000, 'deduct')); // Should be false
            console.log('validateBalanceOperation(0, -100, "set"):', validateBalanceOperation(0, -100, 'set')); // Should be false
            console.log('validateBalanceOperation(0, 100, "set"):', validateBalanceOperation(0, 100, 'set')); // Should be true

            // Test current balance
            console.log('Current balance in state:', state.balance);
            console.log('Current welcome bonus amount:', state.welcomeBonusAmount);

            // Test investment overview calculation
            if (state.investments && state.investments.length > 0) {
                const totalInvested = state.investments.reduce((total, inv) => {
                    return total + (inv.status === 'Active' || inv.status === 'Completed' ? inv.investedAmount : 0);
                }, 0);
                console.log('Total invested amount:', totalInvested);

                const activeInvestments = state.investments.filter(inv =>
                    inv.status === 'Active' || !inv.status
                ).length;
                console.log('Active investments count:', activeInvestments);
            }

            console.log('✅ Balance functionality test completed');
            console.log('💡 To test with actual data:');
            console.log('1. Register a new user to test automatic welcome bonus');
            console.log('2. Make a deposit and check if it appears in balance');
            console.log('3. Try to invest an amount larger than your balance (should fail)');
            console.log('4. Try to withdraw more than your balance (should fail)');
        };

        // Test reCAPTCHA functionality (for Google Sign-In)
        window.testRecaptcha = async function() {
            console.log('🧪 Testing Google Sign-In...');

            try {
                // Check if Firebase Auth is ready
                if (!auth) {
                    console.error('❌ Firebase Auth not initialized');
                    showNotification('Firebase not ready. Please refresh the page.', 'error');
                    return;
                }

                console.log('✅ Firebase Auth is ready');
                console.log('🔍 Current domain:', window.location.hostname);
                console.log('🏗️ Project ID:', firebaseConfig.projectId);

                // Test if we can check sign-in methods
                const signInMethods = await auth.fetchSignInMethodsForEmail('test@example.com');
                console.log('📧 Available sign-in methods:', signInMethods);

                console.log('✅ Google Sign-In test completed successfully');
                showNotification('Google Sign-In is working correctly!', 'success');

            } catch (error) {
                console.error('❌ Google Sign-In test failed:', error);
                if (error.code === 'auth/operation-not-allowed') {
                    showNotification('Google Sign-In needs domain authorization. Check Firebase Console.', 'error');
                    showTroubleshooting();
                } else {
                    showNotification('Google Sign-In test failed. Check console for details.', 'error');
                }
            }
        };

        // Test user-specific investment filtering
        window.testUserSpecificFiltering = async function() {
            console.log('🧪 Testing user-specific investment filtering...');

            if (!state.user) {
                showNotification('Please login first to test user-specific filtering.', 'error');
                return;
            }

            try {
                console.log('🔍 Testing investment access for user:', state.user.uid);

                // Test 1: Try to access all investments (should be filtered by security rules)
                console.log('📊 Test 1: Checking total investments in collection...');
                const allInvestmentsSnapshot = await db.collection('investments').get();
                console.log('Total investments in collection:', allInvestmentsSnapshot.size);

                // Test 2: Load user-specific investments using the app's function
                console.log('📊 Test 2: Loading user-specific investments...');
                await loadUserInvestments();

                // Test 3: Verify all loaded investments belong to current user
                console.log('📊 Test 3: Verifying user ownership of loaded investments...');
                let validationErrors = 0;

                state.investments.forEach((investment, index) => {
                    if (!validateUserAccess(investment, 'userId')) {
                        console.error(`❌ Validation failed for investment ${index + 1}:`, investment);
                        validationErrors++;
                    }
                });

                if (validationErrors === 0) {
                    console.log('✅ All loaded investments belong to current user');
                    showNotification(`✅ User-specific filtering working correctly! Loaded ${state.investments.length} investment(s) for your account.`, 'success');
                } else {
                    console.error(`❌ ${validationErrors} investment(s) failed user validation`);
                    showNotification(`❌ User-specific filtering issue detected! ${validationErrors} investment(s) may not belong to your account.`, 'error');
                }

                // Test 4: Check Firebase security rules effectiveness
                console.log('📊 Test 4: Testing security rules enforcement...');
                try {
                    // Try to access another user's data (this should fail)
                    const testUserId = 'test-user-id-that-does-not-exist';
                    const testQuery = await db.collection('investments')
                        .where('userId', '==', testUserId)
                        .get();

                    if (testQuery.size === 0) {
                        console.log('✅ Security rules correctly filtered out other users\' data');
                    } else {
                        console.warn('⚠️ Security rules may not be filtering properly');
                    }
                } catch (securityError) {
                    if (securityError.code === 'permission-denied') {
                        console.log('✅ Security rules are working correctly (permission denied as expected)');
                    } else {
                        console.error('❌ Unexpected error testing security rules:', securityError);
                    }
                }

                console.log('🧪 User-specific filtering test completed');
                console.log('📋 Summary:', {
                    totalInvestmentsInCollection: allInvestmentsSnapshot.size,
                    userSpecificInvestmentsLoaded: state.investments.length,
                    validationErrors: validationErrors,
                    currentUserId: state.user.uid
                });

            } catch (error) {
                console.error('❌ Error testing user-specific filtering:', error);
                showNotification('Error testing user-specific filtering. Check console for details.', 'error');
            }
        };


        // Firebase configuration fix helper
        window.fixFirebaseConfig = function() {
            console.log('🔧 Firebase Configuration Helper');
            console.log('Current domain:', window.location.hostname);
            console.log('Firebase project ID:', firebaseConfig.projectId);
            console.log('Auth domain:', firebaseConfig.authDomain);

            console.log('\n📋 To fix the "unauthorized domain" error:');
            console.log('1. Go to Firebase Console: https://console.firebase.google.com/');
            console.log('2. Select your project:', firebaseConfig.projectId);
            console.log('3. Go to Authentication > Settings > Authorized Domains');
            console.log('4. Add your current domain:', window.location.hostname);
            console.log('5. Also add: localhost (for development)');


            console.log('\n🔍 Current Firebase config check:');
            console.log('- API Key:', firebaseConfig.apiKey ? '✅ Set' : '❌ Missing');
            console.log('- Auth Domain:', firebaseConfig.authDomain ? '✅ Set' : '❌ Missing');
            console.log('- Project ID:', firebaseConfig.projectId ? '✅ Set' : '❌ Missing');

            // Show troubleshooting UI
            showTroubleshooting();
        };

        // Show/hide troubleshooting section
        function showTroubleshooting() {
            const troubleshootingDiv = document.getElementById('firebase-troubleshooting');
            const currentDomainSpan = document.getElementById('current-domain');

            if (troubleshootingDiv) {
                troubleshootingDiv.style.display = 'block';
            }

            if (currentDomainSpan) {
                currentDomainSpan.textContent = window.location.hostname;
            }
        }

        function hideTroubleshooting() {
            const troubleshootingDiv = document.getElementById('firebase-troubleshooting');
            if (troubleshootingDiv) {
                troubleshootingDiv.style.display = 'none';
            }
        }



        // Initialize app
        document.addEventListener('DOMContentLoaded', () => {
            // Set up cleanup for page unload
            window.addEventListener('beforeunload', cleanupAllTimers);

            // Set up event listeners
            document.getElementById('registration-form').addEventListener('submit', handleRegistration);
            document.getElementById('login-form').addEventListener('submit', handleLogin);
            document.getElementById('forgot-password-form').addEventListener('submit', handleForgotPassword);
            
            // Deposit form listeners
            document.querySelectorAll('.deposit-form').forEach(form => {
                form.addEventListener('submit', handleDepositSubmit);
            });
            
            // Withdrawal form listener
            document.getElementById('withdrawal-form').addEventListener('submit', handleWithdrawalSubmit);
            
            // Dashboard navigation
            document.querySelectorAll('.dashboard-nav .nav-item').forEach(navItem => {
                navItem.addEventListener('click', (e) => {
                    e.preventDefault();
                    showDashboardTab(navItem.dataset.target);
                });
            });
            
            // Modal close button
            const closeButton = document.querySelector('.modal .close-button');
            const modal = document.getElementById('investment-modal');

            if (closeButton && modal) {
                closeButton.addEventListener('click', () => {
                    modal.style.display = 'none';
                });

                // Modal background click
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.style.display = 'none';
                    }
                });
            }
            
            // Verification code inputs
            document.querySelectorAll('.code-input').forEach(input => {
                input.addEventListener('input', (e) => {
                    if (e.target.value.length === 1) {
                        const nextInput = document.querySelector(`.code-input[data-index="${parseInt(e.target.dataset.index) + 1}"]`);
                        if (nextInput) nextInput.focus();
                    }
                });
                
                input.addEventListener('keydown', (e) => {
                    if (e.key === 'Backspace' && !e.target.value) {
                        const prevInput = document.querySelector(`.code-input[data-index="${parseInt(e.target.dataset.index) - 1}"]`);
                        if (prevInput) prevInput.focus();
                    }
                });
            });
            
            // Check authentication state
            auth.onAuthStateChanged((user) => {
                if (user) {
                    // User is signed in
                    db.collection('users').doc(user.uid).get()
                        .then((userDoc) => {
                            if (userDoc.exists) {
                                const userData = userDoc.data();

                                state.user = {
                                    uid: user.uid,
                                    username: userData.username,
                                    email: userData.email,
                                    phone: userData.phone || ''
                                };

                                state.balance = userData.balance || 0;
                                state.welcomeBonusAmount = userData.welcomeBonusClaimed ? 0 : 4000;
                                state.isLoggedIn = true;

                                // Set up real-time listeners for live data updates
                                setupRealtimeListeners();

                                if (state.currentPage === 'dashboard-page') {
                                    updateDashboard();
                                }
                            }
                        })
                        .catch((error) => {
                            console.error('Error fetching user data:', error);
                        });
                } else {
                    // User is signed out
                    state.user = null;
                    state.balance = 0;
                    state.welcomeBonusAmount = 0;
                    state.investments = [];
                    state.depositHistory = [];
                    state.withdrawHistory = [];
                    state.isLoggedIn = false;

                    document.getElementById('dashboard-page').style.display = 'none';
                    showPage('welcome-page');
                }
            });
            
            // Show initial page
            const initialPage = window.location.hash ? window.location.hash.substring(1) : 'welcome-page';
            showPage(initialPage);
            
            // Start image slideshows
            startHeroSlideshow();
            startBackgroundSlideshow();
        });

        // Image slideshow functions
        function startHeroSlideshow() {
            const stockMarketImages = [
                'https://www.vecteezy.com/vector-art/24813386-stock-market-growth-in-futuristic-technology-style-successful-financial-graphic-on-blue-background-business-growth-illustration-with-the-bar-chart-static-and-up-arrow',
                'https://images.unsplash.com/photo-1611974789855-9c2a0a7236a3?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&h=400',
                'https://images.unsplash.com/photo-1590283603385-17ffb3a7f29f?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&h=400',
                'https://images.unsplash.com/photo-1590479773265-7464e5d48118?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&h=400',
                'https://images.unsplash.com/photo-1563013544-824ae1b704d3?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&h=400',
                'https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&h=400'
            ];
            
            let currentImageIndex = 0;
            const heroImage = document.getElementById('hero-image');
            
            if (heroImage) {
                window.changeHeroImage = function() {
                    currentImageIndex = (currentImageIndex + 1) % stockMarketImages.length;
                    heroImage.style.opacity = '0.5';
                    setTimeout(() => {
                        heroImage.src = stockMarketImages[currentImageIndex];
                        heroImage.style.opacity = '1';
                    }, 300);
                };
                
                setInterval(window.changeHeroImage, 3000);
                heroImage.style.transition = 'opacity 0.3s ease-in-out';
            }
        }

        function startBackgroundSlideshow() {
            const backgroundImages = [
                'https://images.unsplash.com/photo-1611974789855-9c2a0a7236a3?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&h=1080',
                'https://images.unsplash.com/photo-1590283603385-17ffb3a7f29f?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&h=1080',
                'https://images.unsplash.com/photo-1590479773265-7464e5d48118?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&h=1080',
                'https://images.unsplash.com/photo-1563013544-824ae1b704d3?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&h=1080',
                'https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&h=1080',
                'https://images.unsplash.com/photo-1460925895917-afdab827c52f?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&h=1080',
                'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&h=1080',
                'https://images.unsplash.com/photo-1611224923853-80b023f02d71?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&h=1080',
                'https://images.unsplash.com/photo-1579952363873-27d3bfad9c0d?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&h=1080',
                'https://images.unsplash.com/photo-1559526324-4b87b5e36e44?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&h=1080'
            ];
            
            let currentBackgroundIndex = 0;
            
            window.changeBackgroundImage = function() {
                currentBackgroundIndex = (currentBackgroundIndex + 1) % backgroundImages.length;
                const imageUrl = backgroundImages[currentBackgroundIndex];
                document.body.style.backgroundImage = `url('${imageUrl}')`;
            };
            
            document.body.style.backgroundImage = `url('${backgroundImages[0]}')`;
            setInterval(window.changeBackgroundImage, 10000);
        }
    </script>
</body>
</html>
